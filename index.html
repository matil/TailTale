<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0B0E2D">
<title>Tail a Tale - Bedtime Stories in Your Voice</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --nd:#0B0E2D;--nm:#141845;--ns:#1E2460;
  --moon:#FFF8DC;--star:#FFEAA7;
  --lav:#C5B3E6;--lavs:#A78BCC;--lavd:#8B6FC0;
  --warm:#FFD4A2;--wg:#FFBE76;--peach:#FFB8B8;--coral:#FF7979;
  --teal:#55E6C1;--teald:#3DC1A3;
  --tx:#E8E4F0;--txs:#A8A0C0;--txd:#706990;
  --gl:rgba(255,255,255,.06);--glh:rgba(255,255,255,.1);--gls:rgba(255,255,255,.12);
  --bd:rgba(255,255,255,.08);
  --rs:14px;--rm:20px;--rl:28px
}
html,body,#root{height:100%;width:100%;overflow:hidden}
body{font-family:'Nunito',sans-serif;background:var(--nd);color:var(--tx);-webkit-font-smoothing:antialiased}
.bg{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none;background:linear-gradient(180deg,#070A1F 0%,#0B0E2D 25%,#141845 55%,#1A1F55 75%,#1E2460 100%)}
.moon{position:absolute;width:80px;height:80px;border-radius:50%;top:30px;right:25px;background:radial-gradient(circle at 38% 38%,#FFFFFF,#FFFEF5 30%,#FFF8DC 60%,#EDE0AA);box-shadow:0 0 20px 5px rgba(255,250,220,.6),0 0 60px 10px rgba(255,248,200,.35),0 0 120px 20px rgba(255,245,180,.15);animation:mg 6s ease-in-out infinite;transition:opacity .5s,transform .5s}
.bg.dim .moon{opacity:.15;transform:scale(.6);box-shadow:none;animation:none}
.moon::after{content:'';position:absolute;top:8px;left:12px;width:14px;height:14px;border-radius:50%;background:radial-gradient(circle,rgba(210,200,160,.25),transparent 70%)}
.moon::before{content:'';position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 70% 65%,transparent 50%,rgba(200,185,130,.2) 80%)}
@keyframes mg{0%,100%{box-shadow:0 0 20px 5px rgba(255,250,220,.6),0 0 60px 10px rgba(255,248,200,.35),0 0 120px 20px rgba(255,245,180,.15)}50%{box-shadow:0 0 25px 8px rgba(255,250,220,.7),0 0 70px 15px rgba(255,248,200,.4),0 0 140px 25px rgba(255,245,180,.2)}}
.star{position:absolute;border-radius:50%;background:#fff;animation:tw ease-in-out infinite}
@keyframes tw{0%,100%{opacity:.2;transform:scale(.7)}50%{opacity:.8;transform:scale(1.2)}}
.ff{position:absolute;width:4px;height:4px;background:var(--wg);border-radius:50%;animation:ffa ease-in-out infinite;box-shadow:0 0 8px var(--wg)}
@keyframes ffa{0%,100%{opacity:.15;transform:translate(0,0)}25%{opacity:.7;transform:translate(12px,-18px)}50%{opacity:.3;transform:translate(-8px,-30px)}75%{opacity:.8;transform:translate(16px,-12px)}}
.hills{position:absolute;bottom:0;width:100%;height:120px}.hl{position:absolute;bottom:0;border-radius:50% 50% 0 0}
.hl:nth-child(1){width:500px;height:120px;background:#0F1235;left:-80px}.hl:nth-child(2){width:450px;height:95px;background:#121640;left:180px}.hl:nth-child(3){width:600px;height:105px;background:#0D1030;right:-120px}
.app{position:relative;z-index:1;height:100%;display:flex;flex-direction:column;max-width:480px;margin:0 auto}
.hdr{padding:12px 20px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.logo{display:flex;align-items:center;gap:0}
.logo-hdr{height:44px;flex-shrink:0}
.logo-welcome{width:300px;max-width:90vw;margin:0 auto 8px;display:block}
.hbtn{height:36px;padding:0 14px;border-radius:50px;border:1px solid var(--bd);background:var(--gl);font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:5px;color:var(--txs);font-family:'Nunito',sans-serif;transition:.2s}.hbtn:hover{background:var(--glh)}
.main{flex:1;overflow-y:auto;overflow-x:hidden;padding:0 20px 20px;-webkit-overflow-scrolling:touch}.main::-webkit-scrollbar{width:0}
.nav{flex-shrink:0;background:rgba(11,14,45,.92);backdrop-filter:blur(20px);border-radius:22px 22px 0 0;padding:6px 12px 14px;display:flex;justify-content:space-around;border-top:1px solid var(--bd)}
.ni{display:flex;flex-direction:column;align-items:center;gap:3px;background:none;border:none;cursor:pointer;padding:8px 16px;border-radius:14px;transition:.2s;color:var(--txd);font-family:'Nunito'}.ni.a{color:var(--moon);background:rgba(255,248,220,.07)}
.ni-l{font-size:10px;font-weight:700}
.card{background:var(--gl);backdrop-filter:blur(10px);border-radius:var(--rm);padding:18px;margin-bottom:12px;border:1px solid var(--bd)}
.ct{font-family:'Baloo 2',cursive;font-size:17px;font-weight:700;margin-bottom:3px;display:flex;align-items:center;gap:6px}.cs{font-size:13px;color:var(--txs)}
.sr{display:flex;gap:14px;align-items:center;cursor:pointer;padding:14px;border-radius:var(--rm);background:var(--gl);margin-bottom:10px;transition:.25s;border:1px solid var(--bd)}.sr:hover{background:var(--glh)}.sr.sel{border-color:rgba(197,179,230,.4);background:rgba(197,179,230,.08)}
.se{width:54px;height:54px;display:flex;align-items:center;justify-content:center;background:rgba(255,248,220,.06);border-radius:14px;flex-shrink:0}.si{flex:1;min-width:0}.sn{font-family:'Baloo 2',cursive;font-size:15px;font-weight:700;line-height:1.2}.sd{font-size:11px;color:var(--txd);margin-top:2px}
.badge{display:inline-block;padding:1px 7px;border-radius:6px;font-size:9px;font-weight:700;text-transform:uppercase;margin-top:3px}
.b-ft{background:rgba(85,230,193,.1);color:var(--teal)}.b-fb{background:rgba(255,212,162,.1);color:var(--warm)}.b-bt{background:rgba(197,179,230,.1);color:var(--lav)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:13px 24px;border:none;border-radius:var(--rl);font-family:'Baloo 2',cursive;font-size:16px;font-weight:700;cursor:pointer;transition:.2s;white-space:nowrap}
.btn:active{transform:scale(.96)}.btn:disabled{opacity:.35;cursor:not-allowed;transform:none}
.bp{background:linear-gradient(135deg,var(--lavs),var(--lavd));color:#fff;box-shadow:0 5px 20px rgba(167,139,204,.3)}
.bg2{background:var(--gls);color:var(--tx);border:1px solid var(--bd)}.bgr{background:linear-gradient(135deg,var(--teal),var(--teald));color:#0B0E2D}
.bw{width:100%}.bsm{padding:9px 18px;font-size:14px}
.ig{margin-bottom:14px}.il{display:block;font-family:'Baloo 2',cursive;font-size:14px;font-weight:600;margin-bottom:5px;color:var(--txs)}
.inp{width:100%;padding:12px 16px;border:1px solid rgba(255,255,255,.1);border-radius:var(--rs);font-family:'Nunito',sans-serif;font-size:15px;background:rgba(255,255,255,.05);color:var(--tx);transition:.2s}.inp:focus{outline:none;border-color:var(--lavs)}.inp::placeholder{color:var(--txd)}
.sh{font-family:'Baloo 2',cursive;font-size:20px;font-weight:800;margin:16px 0 8px;color:var(--moon);display:flex;align-items:center;gap:8px}.ss{font-size:13px;color:var(--txd);margin-bottom:14px;line-height:1.4}
.rb{width:90px;height:90px;border-radius:50%;border:2px solid rgba(255,121,121,.2);background:linear-gradient(135deg,rgba(255,121,121,.6),rgba(255,121,121,.35));color:#fff;cursor:pointer;box-shadow:0 0 25px rgba(255,121,121,.15);transition:.2s;display:flex;align-items:center;justify-content:center;margin:0 auto}
.rb:hover{transform:scale(1.05)}.rb.rec{animation:rp 1.5s ease-in-out infinite}
@keyframes rp{0%{box-shadow:0 0 0 0 rgba(255,121,121,.4)}70%{box-shadow:0 0 0 22px rgba(255,121,121,0)}100%{box-shadow:0 0 0 0 rgba(255,121,121,0)}}
.wf{display:flex;align-items:center;justify-content:center;gap:3px;height:45px;margin:12px 0}.wb{width:3px;background:var(--lav);border-radius:3px;animation:wa .8s ease-in-out infinite}@keyframes wa{0%,100%{height:6px}50%{height:36px}}
.vc{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:var(--rs);background:var(--gl);margin-bottom:8px;cursor:pointer;transition:.2s;border:1px solid var(--bd)}.vc:hover{background:var(--glh)}.vc.sel{border-color:rgba(85,230,193,.35);background:rgba(85,230,193,.06)}
.va{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.va-u{background:rgba(85,230,193,.1);border:1px solid rgba(85,230,193,.12)}.va-f{background:rgba(255,212,162,.1);border:1px solid rgba(255,212,162,.12)}
.vn{font-weight:700;font-size:14px}.vd{font-size:11px;color:var(--txd)}
.vx{margin-left:auto;background:none;border:none;cursor:pointer;opacity:.3;padding:4px;color:var(--txd)}.vx:hover{opacity:.7}
.pc{border-radius:28px;overflow:hidden;margin-top:6px}.pb{background:linear-gradient(160deg,#1A0A3E,#120835 40%,#0D0628);padding:28px 20px;position:relative;border:1px solid rgba(255,255,255,.05)}
.pti{font-family:'Baloo 2',cursive;font-size:22px;font-weight:700;color:var(--moon);text-align:center}.pau{font-size:12px;color:rgba(255,255,255,.3);text-align:center;margin-top:2px}
.pbar{margin:22px 0 6px;padding:6px 0;cursor:pointer;-webkit-tap-highlight-color:transparent}
.pbtr{width:100%;height:6px;background:rgba(255,255,255,.08);border-radius:3px;position:relative}
.pbfl{height:100%;background:linear-gradient(90deg,var(--lavs),var(--wg));border-radius:3px;transition:width .05s linear;position:relative;will-change:width}
.pbth{position:absolute;right:-8px;top:50%;transform:translateY(-50%);width:18px;height:18px;background:var(--moon);border-radius:50%;box-shadow:0 0 8px rgba(255,248,220,.3)}
.ptm{display:flex;justify-content:space-between;font-size:11px;color:rgba(255,255,255,.25);font-weight:600;font-variant-numeric:tabular-nums}
.pcc{display:flex;align-items:center;justify-content:center;gap:20px;margin-top:20px}
.cb{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.07);color:rgba(255,255,255,.6);width:46px;height:46px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s}.cb:hover{background:rgba(255,255,255,.1);color:#fff}.cb:active{transform:scale(.93)}
.cb.pp{width:64px;height:64px;background:linear-gradient(135deg,var(--lavs),var(--lavd));color:#fff;box-shadow:0 0 25px rgba(167,139,204,.25);border:none}
.pvb{text-align:center;margin-top:16px;font-size:11px;color:rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;gap:4px}.pvb b{color:var(--wg)}
.ra{background:rgba(20,24,69,.5);border-radius:var(--rm);padding:20px;margin-top:14px;max-height:280px;overflow-y:auto;font-size:15px;line-height:1.85;color:rgba(232,228,240,.8);border:1px solid var(--bd);scroll-behavior:smooth}
.ra p{margin-bottom:14px;transition:color .3s}.ra p:last-child{margin-bottom:0}.ra p.hl2{color:var(--wg);font-weight:700;text-shadow:0 0 12px rgba(255,190,118,.2)}
.genst{background:rgba(139,111,192,.12);border:1px solid rgba(139,111,192,.2);border-radius:var(--rs);padding:14px;margin-top:12px;text-align:center;font-size:13px;color:var(--lav);line-height:1.5}
.genst .spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(197,179,230,.3);border-top-color:var(--lav);border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes spin{to{transform:rotate(360deg)}}
.genst .done{color:var(--teal);display:flex;align-items:center;justify-content:center;gap:6px}
.wel{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100%;padding:40px 24px;text-align:center}
.wbx{background:rgba(20,24,69,.8);backdrop-filter:blur(20px);border-radius:var(--rl);padding:24px 20px;width:100%;max-width:340px;border:1px solid var(--bd)}
.flt{display:flex;gap:7px;overflow-x:auto;padding-bottom:3px;margin-bottom:14px;scrollbar-width:none}.flt::-webkit-scrollbar{display:none}
.fc{padding:7px 14px;border-radius:50px;border:1px solid var(--bd);background:var(--gl);font-family:'Nunito';font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;transition:.2s;color:var(--txs)}.fc:hover{background:var(--glh)}.fc.a{background:rgba(167,139,204,.18);color:var(--lav);border-color:rgba(167,139,204,.3)}
.steps{display:flex;gap:7px;margin-bottom:16px}.step{flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,.05);transition:.3s}.step.a{background:var(--lavs)}.step.d{background:var(--teal)}
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:rgba(20,24,69,.95);backdrop-filter:blur(12px);color:var(--moon);padding:10px 22px;border-radius:50px;font-size:13px;font-weight:600;z-index:1000;animation:ti .3s ease-out,tto .3s ease-in 2.5s forwards;border:1px solid var(--bd);white-space:nowrap}
@keyframes ti{from{opacity:0;transform:translateX(-50%) translateY(16px)}}@keyframes tto{to{opacity:0;transform:translateX(-50%) translateY(16px)}}
.info{background:rgba(255,212,162,.05);border:1px solid rgba(255,212,162,.12);border-radius:var(--rs);padding:12px 14px;margin-top:14px;font-size:12px;line-height:1.5;color:var(--txs)}.info b{color:var(--warm)}
.fi{animation:fin .3s ease-out}@keyframes fin{from{opacity:0;transform:translateY(10px)}}
.tut-steps{display:flex;align-items:center;justify-content:center;gap:0;margin:0 auto 24px;width:280px}
.tut-dot{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:var(--txd);transition:.3s;font-family:'Baloo 2',cursive}
.tut-dot.active{border-color:var(--lavs);background:rgba(167,139,204,.2);color:var(--lav)}
.tut-dot.done{border-color:var(--teal);background:rgba(85,230,193,.15);color:var(--teal)}
.tut-line{flex:1;height:2px;background:rgba(255,255,255,.06);transition:.3s}.tut-line.done{background:var(--teal)}
.tut-title{font-family:'Baloo 2',cursive;font-size:24px;font-weight:800;color:var(--moon);text-align:center;margin-bottom:4px}
.tut-sub{font-size:13px;color:var(--txd);text-align:center;margin-bottom:20px;line-height:1.5}
.ico{display:inline-block;vertical-align:middle;flex-shrink:0}
.ver-btns{display:flex;gap:4px;margin-top:4px}.vbtn{padding:2px 10px;border-radius:8px;border:1px solid var(--bd);background:var(--gl);font-family:'Nunito';font-size:10px;font-weight:700;cursor:pointer;transition:.2s;color:var(--txd)}.vbtn:hover{background:var(--glh)}.vbtn.va2{background:rgba(167,139,204,.18);color:var(--lav);border-color:rgba(167,139,204,.3)}
.prewarm{display:flex;align-items:center;gap:6px;padding:8px 12px;border-radius:10px;background:rgba(85,230,193,.06);border:1px solid rgba(85,230,193,.12);margin-top:8px;font-size:12px;color:var(--teal);animation:fin .3s ease-out}
.prewarm .spinner{width:12px;height:12px;border:1.5px solid rgba(85,230,193,.3);border-top-color:var(--teal);border-radius:50%;animation:spin 1s linear infinite;flex-shrink:0}
.slist{max-height:calc(100vh - 280px);overflow-y:auto;-webkit-overflow-scrolling:touch;padding-right:4px;margin-right:-4px}.slist::-webkit-scrollbar{width:3px}.slist::-webkit-scrollbar-track{background:transparent}.slist::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:3px}
.ddmenu{position:absolute;top:48px;right:16px;background:rgba(20,24,69,.97);backdrop-filter:blur(20px);border:1px solid var(--bd);border-radius:var(--rs);padding:6px;min-width:180px;z-index:50;animation:fin .15s ease-out}
.ddi{display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;cursor:pointer;font-size:13px;font-weight:600;color:var(--txs);transition:.15s;width:100%;background:none;border:none;font-family:'Nunito';text-align:left}.ddi:hover{background:var(--gl);color:var(--tx)}
.ddiv{height:1px;background:var(--bd);margin:4px 8px}
.langsel{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0}.langopt{padding:6px 14px;border-radius:10px;border:1px solid var(--bd);background:var(--gl);font-size:12px;font-weight:700;cursor:pointer;transition:.2s;color:var(--txs);font-family:'Nunito'}.langopt:hover{background:var(--glh)}.langopt.a{background:rgba(167,139,204,.2);color:var(--lav);border-color:rgba(167,139,204,.3)}
[dir=rtl] .hdr{flex-direction:row-reverse}[dir=rtl] .sr{flex-direction:row-reverse}[dir=rtl] .si{text-align:right}[dir=rtl] .vc{flex-direction:row-reverse}[dir=rtl] .ct{flex-direction:row-reverse}[dir=rtl] .sh{flex-direction:row-reverse}[dir=rtl] .nav{flex-direction:row-reverse}[dir=rtl] .ddmenu{right:auto;left:16px}[dir=rtl] .ddi{flex-direction:row-reverse;text-align:right}[dir=rtl] .ver-btns{flex-direction:row-reverse}[dir=rtl] .pvb{flex-direction:row-reverse}
.tl-spinner{display:inline-flex;align-items:center;gap:6px;padding:10px 16px;border-radius:10px;background:rgba(139,111,192,.1);color:var(--lav);font-size:12px;font-weight:600;margin:10px 0}
.tl-spinner .spinner{width:14px;height:14px;border:2px solid rgba(197,179,230,.3);border-top-color:var(--lav);border-radius:50%;animation:spin 1s linear infinite}
@media(max-width:380px){.hdr{padding:10px 14px}.main{padding:0 14px 16px}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="module" id="gradio-loader">
import { Client, handle_file } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";
window.__gradio = { Client, handle_file };
window.dispatchEvent(new Event('gradio-ready'));
</script>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback,useMemo}=React;

// Custom Icon Set - consistent 24x24 viewBox, 1.5px stroke, round caps
function Icon({name,size=24,color='currentColor',className=''}){
  const s={width:size,height:size,display:'inline-block',verticalAlign:'middle',flexShrink:0};
  const p={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:s,className:'ico '+className};
  switch(name){
    case 'book': return(<svg {...p}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/><line x1="9" y1="7" x2="16" y2="7"/><line x1="9" y1="11" x2="14" y2="11"/></svg>);
    case 'mic': return(<svg {...p}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>);
    case 'play': return(<svg {...p}><polygon points="5 3 19 12 5 21 5 3" fill={color} stroke="none"/></svg>);
    case 'pause': return(<svg {...p}><rect x="6" y="4" width="4" height="16" rx="1" fill={color} stroke="none"/><rect x="14" y="4" width="4" height="16" rx="1" fill={color} stroke="none"/></svg>);
    case 'stop': return(<svg {...p}><rect x="5" y="5" width="14" height="14" rx="2" fill={color} stroke="none"/></svg>);
    case 'replay': return(<svg {...p}><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>);
    case 'back': return(<svg {...p}><polyline points="15 18 9 12 15 6"/></svg>);
    case 'check': return(<svg {...p} fill="none"><polyline points="20 6 9 17 4 12" stroke={color} strokeWidth="2"/></svg>);
    case 'sparkle': return(<svg {...p}><path d="M12 2l2 6 6 2-6 2-2 6-2-6-6-2 6-2 2-6z" fill={color} stroke="none"/></svg>);
    case 'moon': return(<svg {...p}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill={color} stroke="none" opacity=".8"/></svg>);
    case 'castle': return(<svg {...p}><path d="M3 21V11l3-3V5h2v2l4-4 4 4v2h2v3l3 3v10H3z"/><rect x="9" y="14" width="6" height="7" rx="3" stroke={color}/></svg>);
    case 'fox': return(<svg {...p} stroke="none"><path d="M12 20c-4 0-7-2-7-5s1.5-5 3-6.5L10 3l2 3 2-3 2 5.5c1.5 1.5 3 3.5 3 6.5s-3 5-7 5z" fill={color}/><circle cx="9.5" cy="13" r="1" fill="#0B0E2D"/><circle cx="14.5" cy="13" r="1" fill="#0B0E2D"/><ellipse cx="12" cy="15.5" rx="1.5" ry="1" fill="#2D1B0E"/></svg>);
    case 'brain': return(<svg {...p}><path d="M12 2C9 2 7 4 7 6.5c0 .5.1 1 .3 1.5C5.9 9 5 10.5 5 12.5c0 1.5.8 3 2 3.8C7 17 7.5 18 9 19c1 .7 2 1 3 1s2-.3 3-1c1.5-1 2-2 2-2.7 1.2-.8 2-2.3 2-3.8 0-2-1-3.5-2.3-4.5.2-.5.3-1 .3-1.5C17 4 15 2 12 2z"/><path d="M12 2v18" strokeDasharray="2 2" opacity=".3"/></svg>);
    case 'phone': return(<svg {...p}><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18" strokeWidth="2"/></svg>);
    case 'trash': return(<svg {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>);
    case 'right': return(<svg {...p}><polyline points="9 18 15 12 9 6"/></svg>);
    case 'record': return(<svg {...p}><circle cx="12" cy="12" r="8" fill={color} stroke="none"/></svg>);
    case 'user': return(<svg {...p}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>);
    case 'globe': return(<svg {...p}><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>);
    case 'logout': return(<svg {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>);
    default: return null;
  }
}

// â•â•â•â•â•â•â•â•â•â• i18n â•â•â•â•â•â•â•â•â•â•
const LANGS=[
  {c:'en',n:'English',f:'ðŸ‡¬ðŸ‡§',d:'ltr'},
  {c:'he',n:'×¢×‘×¨×™×ª',f:'ðŸ‡®ðŸ‡±',d:'rtl'},
  {c:'es',n:'EspaÃ±ol',f:'ðŸ‡ªðŸ‡¸',d:'ltr'},
  {c:'fr',n:'FranÃ§ais',f:'ðŸ‡«ðŸ‡·',d:'ltr'},
  {c:'ar',n:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',f:'ðŸ‡¸ðŸ‡¦',d:'rtl'},
  {c:'ru',n:'Ð ÑƒÑÑÐºÐ¸Ð¹',f:'ðŸ‡·ðŸ‡º',d:'ltr'},
  {c:'pt',n:'PortuguÃªs',f:'ðŸ‡§ðŸ‡·',d:'ltr'},
  {c:'zh',n:'ä¸­æ–‡',f:'ðŸ‡¨ðŸ‡³',d:'ltr'},
];
const UI={
  en:{whosReading:"Who's reading tonight?",placeholder:"Mom, Dad, Grandma...",getStarted:"Get Started",setupVoice:"Set Up Your Voice",voiceSub:"Record 6-10 seconds reading softly. AI will learn to speak like you!",pickStory:"Pick a Story",storySub:"Choose tonight's bedtime adventure",startReading:"Start Reading",continue:"Continue",stories:"Stories",voices:"Voices",play:"Play",bedtimeStories:"Bedtime Stories",chooseAdventure:"Choose tonight's adventure",yourVoices:"Your Voices",recSub:"Record 6-10 seconds. Chatterbox AI will clone your voice!",recordVoice:"Record Your Voice",readSoftly:"Read softly for 6-10 seconds",tapRecord:"Tap to record",recording:"Recording",recorded:"Recorded!",nameVoice:"Name this voice",voicePlaceholder:"Mom's bedtime voice",redo:"Redo",save:"Save",clonedVoices:"Cloned Voices",aiClone:"AI voice clone",deviceVoices:"Device Voices",deviceVoice:"Device voice",goodnight:"Goodnight",voice:"Voice",story:"Story",noneSelected:"None selected",change:"Change",pick:"Pick",beginStory:"Begin Story",connected:"Chatterbox AI connected",connecting:"Connecting to AI...",cloneMsg:"Story will be read in YOUR cloned voice.",deviceMsg:"Select a recorded voice for AI cloning, or use device voice.",back:"Back",storyComplete:"Story complete! Sweet dreams.",warming:"Warming up AI with your voice...",cloneReady:"Voice clone ready! GPU is warm.",howClone:"How voice cloning works:",howCloneDesc:"Your recording is sent to Chatterbox AI (open-source) running on HuggingFace free GPU. It clones your voice and reads the story.",all:"All",fairytales:"Fairytales",fables:"Fables",bedtime:"Bedtime",short:"Short",long:"Long",switchUser:"Switch User",language:"Language",settings:"Settings",cloningPart:"Cloning voice: part",gpuWake:"First time may take 30-60s (GPU waking up)...",readSample:"The stars twinkled brightly as the little bear drifted off to sleep in the magical forest.",hi:"Hi"},
  he:{whosReading:"×ž×™ ×§×•×¨× ×”×œ×™×œ×”?",placeholder:"××ž×, ××‘×, ×¡×‘×ª×...",getStarted:"×‘×•××• × ×ª×—×™×œ",setupVoice:"×”×’×“×¨×ª ×§×•×œ",voiceSub:"×”×§×œ×™×˜×• 6-10 ×©× ×™×•×ª ×©×œ ×§×¨×™××” ×¨×›×”. ×”×‘×™× ×” ×”×ž×œ××›×•×ª×™×ª ×ª×œ×ž×“ ×œ×“×‘×¨ ×›×ž×•×›×!",pickStory:"×‘×—×¨×• ×¡×™×¤×•×¨",storySub:"×‘×—×¨×• ××ª ×”×¨×¤×ª×§×ª ×”×©×™× ×” ×©×œ ×”×œ×™×œ×”",startReading:"×”×ª×—×œ ×œ×§×¨×•×",continue:"×”×ž×©×š",stories:"×¡×™×¤×•×¨×™×",voices:"×§×•×œ×•×ª",play:"× ×’×Ÿ",bedtimeStories:"×¡×™×¤×•×¨×™ ×©×™× ×”",chooseAdventure:"×‘×—×¨×• ××ª ×”×¨×¤×ª×§×ª ×”×œ×™×œ×”",yourVoices:"×”×§×•×œ×•×ª ×©×œ×›×",recSub:"×”×§×œ×™×˜×• 6-10 ×©× ×™×•×ª. Chatterbox AI ×™×©×›×¤×œ ××ª ×”×§×•×œ ×©×œ×›×!",recordVoice:"×”×§×œ×™×˜×• ××ª ×”×§×•×œ ×©×œ×›×",readSoftly:"×§×¨××• ×‘×¨×›×•×ª 6-10 ×©× ×™×•×ª",tapRecord:"×œ×—×¦×• ×œ×”×§×œ×˜×”",recording:"×ž×§×œ×™×˜",recorded:"×”×•×§×œ×˜!",nameVoice:"×ª× ×• ×©× ×œ×§×•×œ",voicePlaceholder:"×§×•×œ ×”×©×™× ×” ×©×œ ××ž×",redo:"×ž×—×“×©",save:"×©×ž×•×¨",clonedVoices:"×§×•×œ×•×ª ×ž×©×•×›×¤×œ×™×",aiClone:"×©×›×¤×•×œ ×§×•×œ AI",deviceVoices:"×§×•×œ×•×ª ×”×ž×›×©×™×¨",deviceVoice:"×§×•×œ ×ž×›×©×™×¨",goodnight:"×œ×™×œ×” ×˜×•×‘",voice:"×§×•×œ",story:"×¡×™×¤×•×¨",noneSelected:"×œ× × ×‘×—×¨",change:"×©× ×”",pick:"×‘×—×¨",beginStory:"×”×ª×—×œ ×¡×™×¤×•×¨",connected:"Chatterbox AI ×ž×—×•×‘×¨",connecting:"×ž×ª×—×‘×¨ ×œ-AI...",cloneMsg:"×”×¡×™×¤×•×¨ ×™×™×§×¨× ×‘×§×•×œ ×”×ž×©×•×›×¤×œ ×©×œ×›×.",deviceMsg:"×‘×—×¨×• ×§×•×œ ×ž×•×§×œ×˜ ×œ×©×›×¤×•×œ AI, ××• ×”×©×ª×ž×©×• ×‘×§×•×œ ×”×ž×›×©×™×¨.",back:"×—×–×¨×”",storyComplete:"×”×¡×™×¤×•×¨ ×”×¡×ª×™×™×! ×—×œ×•×ž×•×ª ×ž×ª×•×§×™×.",warming:"×ž×—×ž× ××ª ×”-AI ×¢× ×”×§×•×œ ×©×œ×›×...",cloneReady:"×©×›×¤×•×œ ×”×§×•×œ ×ž×•×›×Ÿ!",howClone:"××™×š ×©×›×¤×•×œ ×§×•×œ ×¢×•×‘×“:",howCloneDesc:"×”×”×§×œ×˜×” × ×©×œ×—×ª ×œ-Chatterbox AI (×§×•×“ ×¤×ª×•×—) ×©×¨×¥ ×¢×œ GPU ×—×™× ×ž×™ ×‘-HuggingFace. ×”×•× ×ž×©×›×¤×œ ××ª ×”×§×•×œ ×©×œ×›× ×•×§×•×¨× ××ª ×”×¡×™×¤×•×¨.",all:"×”×›×œ",fairytales:"××’×“×•×ª",fables:"×ž×©×œ×™×",bedtime:"×©×™× ×”",short:"×§×¦×¨",long:"××¨×•×š",switchUser:"×”×—×œ×£ ×ž×©×ª×ž×©",language:"×©×¤×”",settings:"×”×’×“×¨×•×ª",cloningPart:"×ž×©×›×¤×œ ×§×•×œ: ×—×œ×§",gpuWake:"×‘×¤×¢× ×”×¨××©×•× ×” ×–×” ×™×›×•×œ ×œ×§×—×ª 30-60 ×©× ×™×•×ª...",readSample:"×”×›×•×›×‘×™× × ×¦× ×¦×• ×‘×©×§×˜ ×›×©×”×“×•×‘ ×”×§×˜×Ÿ × ×¨×“× ×‘×™×¢×¨ ×”×§×¡×•×.",hi:"×”×™×™"},
  es:{whosReading:"Â¿QuiÃ©n lee esta noche?",placeholder:"MamÃ¡, PapÃ¡, Abuela...",getStarted:"Empezar",setupVoice:"Configura tu voz",voiceSub:"Graba 6-10 segundos leyendo suavemente. Â¡La IA aprenderÃ¡ a hablar como tÃº!",pickStory:"Elige un cuento",storySub:"Elige la aventura de esta noche",startReading:"Empezar a leer",continue:"Continuar",stories:"Cuentos",voices:"Voces",play:"Play",bedtimeStories:"Cuentos para dormir",chooseAdventure:"Elige la aventura de esta noche",yourVoices:"Tus voces",recSub:"Graba 6-10 seg. Â¡Chatterbox AI clonarÃ¡ tu voz!",recordVoice:"Graba tu voz",readSoftly:"Lee suavemente 6-10 segundos",tapRecord:"Toca para grabar",recording:"Grabando",recorded:"Â¡Grabado!",nameVoice:"Nombre de esta voz",voicePlaceholder:"Voz de mamÃ¡",redo:"Rehacer",save:"Guardar",clonedVoices:"Voces clonadas",aiClone:"Clon de voz AI",deviceVoices:"Voces del dispositivo",deviceVoice:"Voz del dispositivo",goodnight:"Buenas noches",voice:"Voz",story:"Cuento",noneSelected:"No seleccionado",change:"Cambiar",pick:"Elegir",beginStory:"Empezar cuento",connected:"Chatterbox AI conectado",connecting:"Conectando a AI...",cloneMsg:"El cuento se leerÃ¡ con TU voz clonada.",deviceMsg:"Selecciona una voz grabada para clonar, o usa la voz del dispositivo.",back:"Volver",storyComplete:"Â¡Cuento terminado! Dulces sueÃ±os.",warming:"Preparando la AI con tu voz...",cloneReady:"Â¡Clon de voz listo!",howClone:"CÃ³mo funciona la clonaciÃ³n:",howCloneDesc:"Tu grabaciÃ³n se envÃ­a a Chatterbox AI en HuggingFace. Clona tu voz y lee el cuento.",all:"Todo",fairytales:"Cuentos de hadas",fables:"FÃ¡bulas",bedtime:"Dormir",short:"Corto",long:"Largo",switchUser:"Cambiar usuario",language:"Idioma",settings:"Ajustes",cloningPart:"Clonando voz: parte",gpuWake:"La primera vez puede tardar 30-60s...",readSample:"Las estrellas brillaban suavemente mientras el pequeÃ±o oso se dormÃ­a en el bosque mÃ¡gico.",hi:"Hola"},
  fr:{whosReading:"Qui lit ce soir ?",placeholder:"Maman, Papa, Mamie...",getStarted:"Commencer",setupVoice:"Configure ta voix",voiceSub:"Enregistre 6-10 secondes en lisant doucement. L'IA apprendra Ã  parler comme toi !",pickStory:"Choisis une histoire",storySub:"Choisis l'aventure de ce soir",startReading:"Commencer la lecture",continue:"Continuer",stories:"Histoires",voices:"Voix",play:"Jouer",bedtimeStories:"Histoires du soir",chooseAdventure:"Choisis l'aventure de ce soir",yourVoices:"Tes voix",recSub:"Enregistre 6-10 sec. Chatterbox AI clonera ta voix !",recordVoice:"Enregistre ta voix",readSoftly:"Lis doucement 6-10 secondes",tapRecord:"Appuie pour enregistrer",recording:"Enregistrement",recorded:"EnregistrÃ© !",nameVoice:"Nom de cette voix",voicePlaceholder:"Voix de maman",redo:"Refaire",save:"Sauvegarder",clonedVoices:"Voix clonÃ©es",aiClone:"Clone vocal IA",deviceVoices:"Voix de l'appareil",deviceVoice:"Voix appareil",goodnight:"Bonne nuit",voice:"Voix",story:"Histoire",noneSelected:"Non sÃ©lectionnÃ©",change:"Changer",pick:"Choisir",beginStory:"Lancer l'histoire",connected:"Chatterbox AI connectÃ©",connecting:"Connexion Ã  l'IA...",cloneMsg:"L'histoire sera lue avec TA voix clonÃ©e.",deviceMsg:"SÃ©lectionne une voix enregistrÃ©e ou utilise la voix de l'appareil.",back:"Retour",storyComplete:"Histoire terminÃ©e ! Fais de beaux rÃªves.",warming:"PrÃ©paration de l'IA avec ta voix...",cloneReady:"Clone vocal prÃªt !",howClone:"Comment Ã§a marche :",howCloneDesc:"Ton enregistrement est envoyÃ© Ã  Chatterbox AI sur HuggingFace. Il clone ta voix et lit l'histoire.",all:"Tout",fairytales:"Contes de fÃ©es",fables:"Fables",bedtime:"Dodo",short:"Court",long:"Long",switchUser:"Changer d'utilisateur",language:"Langue",settings:"ParamÃ¨tres",cloningPart:"Clonage vocal : partie",gpuWake:"La premiÃ¨re fois peut prendre 30-60s...",readSample:"Les Ã©toiles scintillaient doucement tandis que le petit ours s'endormait dans la forÃªt magique.",hi:"Salut"},
  ar:{whosReading:"Ù…Ù† ÙŠÙ‚Ø±Ø£ Ø§Ù„Ù„ÙŠÙ„Ø©ØŸ",placeholder:"Ù…Ø§Ù…Ø§ØŒ Ø¨Ø§Ø¨Ø§ØŒ Ø¬Ø¯ØªÙŠ...",getStarted:"Ø§Ø¨Ø¯Ø£",setupVoice:"Ø¥Ø¹Ø¯Ø§Ø¯ ØµÙˆØªÙƒ",voiceSub:"Ø³Ø¬Ù‘Ù„ 6-10 Ø«ÙˆØ§Ù†Ù Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ù‡Ø¯ÙˆØ¡. Ø³ÙŠØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø«Ù„Ùƒ!",pickStory:"Ø§Ø®ØªØ± Ù‚ØµØ©",storySub:"Ø§Ø®ØªØ± Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù„ÙŠÙ„Ø©",startReading:"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",continue:"Ù…ØªØ§Ø¨Ø¹Ø©",stories:"Ù‚ØµØµ",voices:"Ø£ØµÙˆØ§Øª",play:"ØªØ´ØºÙŠÙ„",bedtimeStories:"Ù‚ØµØµ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…",chooseAdventure:"Ø§Ø®ØªØ± Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù„ÙŠÙ„Ø©",yourVoices:"Ø£ØµÙˆØ§ØªÙƒ",recSub:"Ø³Ø¬Ù‘Ù„ 6-10 Ø«ÙˆØ§Ù†Ù. Ø³ÙŠØ³ØªÙ†Ø³Ø® Chatterbox AI ØµÙˆØªÙƒ!",recordVoice:"Ø³Ø¬Ù‘Ù„ ØµÙˆØªÙƒ",readSoftly:"Ø§Ù‚Ø±Ø£ Ø¨Ù‡Ø¯ÙˆØ¡ 6-10 Ø«ÙˆØ§Ù†Ù",tapRecord:"Ø§Ø¶ØºØ· Ù„Ù„ØªØ³Ø¬ÙŠÙ„",recording:"Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„",recorded:"ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„!",nameVoice:"Ø³Ù…Ù‘ Ù‡Ø°Ø§ Ø§Ù„ØµÙˆØª",voicePlaceholder:"ØµÙˆØª Ù…Ø§Ù…Ø§",redo:"Ø¥Ø¹Ø§Ø¯Ø©",save:"Ø­ÙØ¸",clonedVoices:"Ø£ØµÙˆØ§Øª Ù…Ø³ØªÙ†Ø³Ø®Ø©",aiClone:"Ø§Ø³ØªÙ†Ø³Ø§Ø® ØµÙˆØªÙŠ",deviceVoices:"Ø£ØµÙˆØ§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²",deviceVoice:"ØµÙˆØª Ø§Ù„Ø¬Ù‡Ø§Ø²",goodnight:"ØªØµØ¨Ø­ Ø¹Ù„Ù‰ Ø®ÙŠØ±",voice:"ØµÙˆØª",story:"Ù‚ØµØ©",noneSelected:"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±",change:"ØªØºÙŠÙŠØ±",pick:"Ø§Ø®ØªØ±",beginStory:"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚ØµØ©",connected:"AI Ù…ØªØµÙ„",connecting:"Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...",cloneMsg:"Ø³ØªÙÙ‚Ø±Ø£ Ø§Ù„Ù‚ØµØ© Ø¨ØµÙˆØªÙƒ Ø§Ù„Ù…Ø³ØªÙ†Ø³Ø®.",deviceMsg:"Ø§Ø®ØªØ± ØµÙˆØªØ§Ù‹ Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… ØµÙˆØª Ø§Ù„Ø¬Ù‡Ø§Ø².",back:"Ø±Ø¬ÙˆØ¹",storyComplete:"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù‚ØµØ©! Ø£Ø­Ù„Ø§Ù… Ø³Ø¹ÙŠØ¯Ø©.",warming:"ØªØ¬Ù‡ÙŠØ² AI Ø¨ØµÙˆØªÙƒ...",cloneReady:"Ø§Ù„ØµÙˆØª Ø¬Ø§Ù‡Ø²!",howClone:"ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:",howCloneDesc:"ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¥Ù„Ù‰ Chatterbox AI. ÙŠØ³ØªÙ†Ø³Ø® ØµÙˆØªÙƒ ÙˆÙŠÙ‚Ø±Ø£ Ø§Ù„Ù‚ØµØ©.",all:"Ø§Ù„ÙƒÙ„",fairytales:"Ø­ÙƒØ§ÙŠØ§Øª",fables:"Ø®Ø±Ø§ÙØ§Øª",bedtime:"Ù†ÙˆÙ…",short:"Ù‚ØµÙŠØ±",long:"Ø·ÙˆÙŠÙ„",switchUser:"ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",language:"Ø§Ù„Ù„ØºØ©",settings:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",cloningPart:"Ø§Ø³ØªÙ†Ø³Ø§Ø®: Ø¬Ø²Ø¡",gpuWake:"Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ 30-60 Ø«Ø§Ù†ÙŠØ©...",readSample:"ØªÙ„Ø£Ù„Ø£Øª Ø§Ù„Ù†Ø¬ÙˆÙ… Ø¨Ù‡Ø¯ÙˆØ¡ Ø¨ÙŠÙ†Ù…Ø§ ØºÙØ§ Ø§Ù„Ø¯Ø¨ Ø§Ù„ØµØºÙŠØ± ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ©.",hi:"Ù…Ø±Ø­Ø¨Ø§Ù‹"},
  ru:{whosReading:"ÐšÑ‚Ð¾ Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ ÑÐµÐ³Ð¾Ð´Ð½Ñ?",placeholder:"ÐœÐ°Ð¼Ð°, ÐŸÐ°Ð¿Ð°, Ð‘Ð°Ð±ÑƒÑˆÐºÐ°...",getStarted:"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ",setupVoice:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ ÑÐ²Ð¾Ð¹ Ð³Ð¾Ð»Ð¾Ñ",voiceSub:"Ð—Ð°Ð¿Ð¸ÑˆÐ¸ 6-10 ÑÐµÐºÑƒÐ½Ð´ Ñ‚Ð¸Ñ…Ð¾Ð³Ð¾ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ. Ð˜Ð˜ Ð½Ð°ÑƒÑ‡Ð¸Ñ‚ÑÑ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ ÐºÐ°Ðº Ñ‚Ñ‹!",pickStory:"Ð’Ñ‹Ð±ÐµÑ€Ð¸ ÑÐºÐ°Ð·ÐºÑƒ",storySub:"Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ñ€Ð¸ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ñ‡ÑŒ",startReading:"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ",continue:"ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ",stories:"Ð¡ÐºÐ°Ð·ÐºÐ¸",voices:"Ð“Ð¾Ð»Ð¾ÑÐ°",play:"Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ",bedtimeStories:"Ð¡ÐºÐ°Ð·ÐºÐ¸ Ð½Ð° Ð½Ð¾Ñ‡ÑŒ",chooseAdventure:"Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ñ€Ð¸ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ",yourVoices:"Ð¢Ð²Ð¾Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ°",recSub:"Ð—Ð°Ð¿Ð¸ÑˆÐ¸ 6-10 ÑÐµÐº. Chatterbox AI ÐºÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐµÑ‚ Ñ‚Ð²Ð¾Ð¹ Ð³Ð¾Ð»Ð¾Ñ!",recordVoice:"Ð—Ð°Ð¿Ð¸ÑˆÐ¸ Ð³Ð¾Ð»Ð¾Ñ",readSoftly:"Ð§Ð¸Ñ‚Ð°Ð¹ Ñ‚Ð¸Ñ…Ð¾ 6-10 ÑÐµÐºÑƒÐ½Ð´",tapRecord:"ÐÐ°Ð¶Ð¼Ð¸ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸",recording:"Ð—Ð°Ð¿Ð¸ÑÑŒ",recorded:"Ð—Ð°Ð¿Ð¸ÑÐ°Ð½Ð¾!",nameVoice:"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð³Ð¾Ð»Ð¾ÑÐ°",voicePlaceholder:"Ð“Ð¾Ð»Ð¾Ñ Ð¼Ð°Ð¼Ñ‹",redo:"Ð—Ð°Ð½Ð¾Ð²Ð¾",save:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",clonedVoices:"ÐšÐ»Ð¾Ð½Ñ‹ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²",aiClone:"Ð˜Ð˜-ÐºÐ»Ð¾Ð½ Ð³Ð¾Ð»Ð¾ÑÐ°",deviceVoices:"Ð“Ð¾Ð»Ð¾ÑÐ° ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°",deviceVoice:"Ð“Ð¾Ð»Ð¾Ñ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°",goodnight:"Ð¡Ð¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾Ð¹ Ð½Ð¾Ñ‡Ð¸",voice:"Ð“Ð¾Ð»Ð¾Ñ",story:"Ð¡ÐºÐ°Ð·ÐºÐ°",noneSelected:"ÐÐµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð¾",change:"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",pick:"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ",beginStory:"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑÐºÐ°Ð·ÐºÑƒ",connected:"Chatterbox AI Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ñ‘Ð½",connecting:"ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ...",cloneMsg:"Ð¡ÐºÐ°Ð·ÐºÐ° Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð° Ð¢Ð’ÐžÐ˜Ðœ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð¼.",deviceMsg:"Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ð¹ Ð³Ð¾Ð»Ð¾Ñ Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ð³Ð¾Ð»Ð¾Ñ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°.",back:"ÐÐ°Ð·Ð°Ð´",storyComplete:"Ð¡ÐºÐ°Ð·ÐºÐ° Ð¾ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð°! Ð¡Ð»Ð°Ð´ÐºÐ¸Ñ… ÑÐ½Ð¾Ð².",warming:"ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð˜Ð˜...",cloneReady:"ÐšÐ»Ð¾Ð½ Ð³Ð¾Ð»Ð¾ÑÐ° Ð³Ð¾Ñ‚Ð¾Ð²!",howClone:"ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:",howCloneDesc:"Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð² Chatterbox AI Ð½Ð° HuggingFace. ÐžÐ½ ÐºÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐµÑ‚ Ð³Ð¾Ð»Ð¾Ñ Ð¸ Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ ÑÐºÐ°Ð·ÐºÑƒ.",all:"Ð’ÑÐµ",fairytales:"Ð¡ÐºÐ°Ð·ÐºÐ¸",fables:"Ð‘Ð°ÑÐ½Ð¸",bedtime:"Ð¡Ð¾Ð½",short:"ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹",long:"Ð”Ð»Ð¸Ð½Ð½Ñ‹Ð¹",switchUser:"Ð¡Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",language:"Ð¯Ð·Ñ‹Ðº",settings:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",cloningPart:"ÐšÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ: Ñ‡Ð°ÑÑ‚ÑŒ",gpuWake:"ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ€Ð°Ð· Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ 30-60 ÑÐµÐº...",readSample:"Ð—Ð²Ñ‘Ð·Ð´Ñ‹ Ñ‚Ð¸Ñ…Ð¾ Ð¼ÐµÑ€Ñ†Ð°Ð»Ð¸, Ð¿Ð¾ÐºÐ° Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ Ð¼ÐµÐ´Ð²ÐµÐ¶Ð¾Ð½Ð¾Ðº Ð·Ð°ÑÑ‹Ð¿Ð°Ð» Ð² Ð²Ð¾Ð»ÑˆÐµÐ±Ð½Ð¾Ð¼ Ð»ÐµÑÑƒ.",hi:"ÐŸÑ€Ð¸Ð²ÐµÑ‚"},
  pt:{whosReading:"Quem lÃª esta noite?",placeholder:"MamÃ£e, Papai, VovÃ³...",getStarted:"ComeÃ§ar",setupVoice:"Configure sua voz",voiceSub:"Grave 6-10 segundos lendo suavemente. A IA aprenderÃ¡ a falar como vocÃª!",pickStory:"Escolha uma histÃ³ria",storySub:"Escolha a aventura de hoje",startReading:"ComeÃ§ar a ler",continue:"Continuar",stories:"HistÃ³rias",voices:"Vozes",play:"Play",bedtimeStories:"HistÃ³rias de ninar",chooseAdventure:"Escolha a aventura",yourVoices:"Suas vozes",recSub:"Grave 6-10 seg. Chatterbox AI clonarÃ¡ sua voz!",recordVoice:"Grave sua voz",readSoftly:"Leia suavemente 6-10 seg",tapRecord:"Toque para gravar",recording:"Gravando",recorded:"Gravado!",nameVoice:"Nome desta voz",voicePlaceholder:"Voz da mamÃ£e",redo:"Refazer",save:"Salvar",clonedVoices:"Vozes clonadas",aiClone:"Clone vocal IA",deviceVoices:"Vozes do dispositivo",deviceVoice:"Voz do dispositivo",goodnight:"Boa noite",voice:"Voz",story:"HistÃ³ria",noneSelected:"NÃ£o selecionado",change:"Mudar",pick:"Escolher",beginStory:"Iniciar histÃ³ria",connected:"Chatterbox AI conectado",connecting:"Conectando Ã  IA...",cloneMsg:"A histÃ³ria serÃ¡ lida com SUA voz clonada.",deviceMsg:"Selecione uma voz gravada ou use a voz do dispositivo.",back:"Voltar",storyComplete:"HistÃ³ria completa! Bons sonhos.",warming:"Preparando IA com sua voz...",cloneReady:"Clone vocal pronto!",howClone:"Como funciona:",howCloneDesc:"Sua gravaÃ§Ã£o Ã© enviada ao Chatterbox AI no HuggingFace. Ele clona sua voz e lÃª a histÃ³ria.",all:"Tudo",fairytales:"Contos de fadas",fables:"FÃ¡bulas",bedtime:"Dormir",short:"Curto",long:"Longo",switchUser:"Trocar usuÃ¡rio",language:"Idioma",settings:"ConfiguraÃ§Ãµes",cloningPart:"Clonando: parte",gpuWake:"A primeira vez pode levar 30-60s...",readSample:"As estrelas brilhavam suavemente enquanto o ursinho adormecia na floresta mÃ¡gica.",hi:"OlÃ¡"},
  zh:{whosReading:"ä»Šæ™šè°æ¥è¯»ï¼Ÿ",placeholder:"å¦ˆå¦ˆã€çˆ¸çˆ¸ã€å¥¶å¥¶...",getStarted:"å¼€å§‹",setupVoice:"è®¾ç½®ä½ çš„å£°éŸ³",voiceSub:"è½»å£°æœ—è¯»6-10ç§’ã€‚AIä¼šå­¦ä¹ ä½ çš„å£°éŸ³ï¼",pickStory:"é€‰æ‹©æ•…äº‹",storySub:"é€‰æ‹©ä»Šæ™šçš„å†’é™©",startReading:"å¼€å§‹é˜…è¯»",continue:"ç»§ç»­",stories:"æ•…äº‹",voices:"å£°éŸ³",play:"æ’­æ”¾",bedtimeStories:"ç¡å‰æ•…äº‹",chooseAdventure:"é€‰æ‹©ä»Šæ™šçš„å†’é™©",yourVoices:"ä½ çš„å£°éŸ³",recSub:"å½•åˆ¶6-10ç§’ã€‚Chatterbox AIä¼šå…‹éš†ä½ çš„å£°éŸ³ï¼",recordVoice:"å½•åˆ¶ä½ çš„å£°éŸ³",readSoftly:"è½»å£°æœ—è¯»6-10ç§’",tapRecord:"ç‚¹å‡»å½•åˆ¶",recording:"å½•åˆ¶ä¸­",recorded:"å½•åˆ¶å®Œæˆï¼",nameVoice:"å‘½åè¿™ä¸ªå£°éŸ³",voicePlaceholder:"å¦ˆå¦ˆçš„å£°éŸ³",redo:"é‡åš",save:"ä¿å­˜",clonedVoices:"å…‹éš†å£°éŸ³",aiClone:"AIå£°éŸ³å…‹éš†",deviceVoices:"è®¾å¤‡å£°éŸ³",deviceVoice:"è®¾å¤‡å£°éŸ³",goodnight:"æ™šå®‰",voice:"å£°éŸ³",story:"æ•…äº‹",noneSelected:"æœªé€‰æ‹©",change:"æ›´æ”¹",pick:"é€‰æ‹©",beginStory:"å¼€å§‹æ•…äº‹",connected:"Chatterbox AIå·²è¿žæŽ¥",connecting:"è¿žæŽ¥AIä¸­...",cloneMsg:"æ•…äº‹å°†ç”¨ä½ å…‹éš†çš„å£°éŸ³æœ—è¯»ã€‚",deviceMsg:"é€‰æ‹©å½•åˆ¶çš„å£°éŸ³è¿›è¡ŒAIå…‹éš†ï¼Œæˆ–ä½¿ç”¨è®¾å¤‡å£°éŸ³ã€‚",back:"è¿”å›ž",storyComplete:"æ•…äº‹ç»“æŸï¼åšä¸ªå¥½æ¢¦ã€‚",warming:"æ­£åœ¨ç”¨ä½ çš„å£°éŸ³é¢„çƒ­AI...",cloneReady:"å£°éŸ³å…‹éš†å°±ç»ªï¼",howClone:"å·¥ä½œåŽŸç†ï¼š",howCloneDesc:"ä½ çš„å½•éŸ³è¢«å‘é€åˆ°HuggingFaceä¸Šçš„Chatterbox AIã€‚å®ƒå…‹éš†ä½ çš„å£°éŸ³å¹¶æœ—è¯»æ•…äº‹ã€‚",all:"å…¨éƒ¨",fairytales:"ç«¥è¯",fables:"å¯“è¨€",bedtime:"ç¡å‰",short:"çŸ­ç¯‡",long:"é•¿ç¯‡",switchUser:"åˆ‡æ¢ç”¨æˆ·",language:"è¯­è¨€",settings:"è®¾ç½®",cloningPart:"å…‹éš†å£°éŸ³ï¼šç¬¬",gpuWake:"é¦–æ¬¡å¯èƒ½éœ€è¦30-60ç§’...",readSample:"æ˜Ÿæ˜Ÿåœ¨å¤œç©ºä¸­é™é™é—ªçƒï¼Œå°ç†Šåœ¨é­”æ³•æ£®æž—é‡Œå®‰ç„¶å…¥ç¡ã€‚",hi:"ä½ å¥½"},
};
function makeT(lang){return(key)=>(UI[lang]&&UI[lang][key])||UI.en[key]||key}
function getLangDir(lang){const l=LANGS.find(x=>x.c===lang);return l?l.d:'ltr'}

// Story Illustrations - unique square SVG icon per story
function StoryIcon({id,size=48}){
  const s={width:size,height:size,display:'block'};
  const p={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",fill:"none",style:s};
  switch(id){
    case 's1': // Three Little Pigs - three houses
      return(<svg {...p}>
        <rect x="4" y="28" width="11" height="12" rx="1" fill="#F5D6A0" stroke="#C9A96E" strokeWidth=".5"/>
        <path d="M3 28L9.5 20L16 28" fill="#E8C170" stroke="#C9A96E" strokeWidth=".5"/>
        <line x1="7" y1="22" x2="12" y2="22" stroke="#C9A96E" strokeWidth=".3" opacity=".5"/>
        <rect x="7" y="32" width="4" height="5" rx=".5" fill="#8B6914" opacity=".4"/>
        <rect x="18" y="24" width="12" height="16" rx="1" fill="#B8845A" stroke="#8B6340" strokeWidth=".5"/>
        <path d="M17 24L24 16L31 24" fill="#9B6B42" stroke="#8B6340" strokeWidth=".5"/>
        <line x1="20" y1="18" x2="28" y2="18" stroke="#8B6340" strokeWidth=".3" opacity=".3"/>
        <rect x="21" y="28" width="5" height="6" rx=".5" fill="#5C3D1E" opacity=".4"/>
        <rect x="33" y="20" width="12" height="20" rx="1" fill="#CC4444" stroke="#993333" strokeWidth=".5"/>
        <path d="M32 20L39 10L46 20" fill="#AA3333" stroke="#993333" strokeWidth=".5"/>
        <rect x="36" y="24" width="5" height="6" rx=".5" fill="#FFE4A0" opacity=".5"/>
        <rect x="37" y="32" width="4" height="6" rx=".5" fill="#5C2020" opacity=".5"/>
        <line x1="38.5" y1="24" x2="38.5" y2="30" stroke="#993333" strokeWidth=".3"/>
        <line x1="36" y1="27" x2="41" y2="27" stroke="#993333" strokeWidth=".3"/>
        <circle cx="8" cy="6" r="2" fill="#FFEAA7" opacity=".5"/>
        <circle cx="40" cy="5" r="1.5" fill="#FFEAA7" opacity=".4"/>
      </svg>);
    case 's2': // Goldilocks - three bowls on a table
      return(<svg {...p}>
        <rect x="6" y="26" width="36" height="3" rx="1" fill="#8B6340"/>
        <rect x="8" y="29" width="3" height="12" fill="#6B4320"/><rect x="37" y="29" width="3" height="12" fill="#6B4320"/>
        <ellipse cx="13" cy="24" rx="5" ry="3.5" fill="#E8D4B0" stroke="#C9A96E" strokeWidth=".5"/>
        <ellipse cx="13" cy="22" rx="3.5" ry="1.5" fill="#F5E6C8" opacity=".6"/>
        <path d="M8 24 Q8 20 10 19" stroke="#C9A96E" strokeWidth=".8" fill="none"/>
        <ellipse cx="24" cy="23" rx="6" ry="4" fill="#E8D4B0" stroke="#C9A96E" strokeWidth=".5"/>
        <ellipse cx="24" cy="21" rx="4.5" ry="2" fill="#F5E6C8" opacity=".6"/>
        <path d="M18 23 Q18 18 20 17" stroke="#C9A96E" strokeWidth=".8" fill="none"/>
        <ellipse cx="36" cy="22" rx="7" ry="5" fill="#E8D4B0" stroke="#C9A96E" strokeWidth=".5"/>
        <ellipse cx="36" cy="19.5" rx="5.5" ry="2.5" fill="#F5E6C8" opacity=".6"/>
        <path d="M29 22 Q29 16 31 15" stroke="#C9A96E" strokeWidth=".8" fill="none"/>
        <circle cx="13" cy="22" r="1" fill="#FFBE76" opacity=".5"/>
        <circle cx="24" cy="21" r="1.2" fill="#FFBE76" opacity=".5"/>
        <circle cx="36" cy="19" r="1.5" fill="#FFBE76" opacity=".5"/>
        <path d="M20 8 Q22 4 24 8" stroke="#F5A623" strokeWidth="1.5" fill="none"/>
        <path d="M22 10 Q24 5 26 10" stroke="#F5A623" strokeWidth="1" fill="none" opacity=".5"/>
        <circle cx="24" cy="3" r="1" fill="#FFEAA7" opacity=".6"/>
      </svg>);
    case 's3': // Ugly Duckling - small grey duckling + swan reflection
      return(<svg {...p}>
        <path d="M4 34 Q12 30 24 32 Q36 30 44 34 L44 44 L4 44Z" fill="#3D5A80" opacity=".3"/>
        <path d="M4 36 Q12 33 24 35 Q36 33 44 36 L44 44 L4 44Z" fill="#4A7FB5" opacity=".2"/>
        <ellipse cx="18" cy="24" rx="7" ry="5" fill="#9E9E9E"/>
        <circle cx="13" cy="20" r="4.5" fill="#ABABAB"/>
        <circle cx="11.5" cy="19" r=".8" fill="#333"/>
        <path d="M9 21 L7 20.5 L9 20" fill="#F5A623" stroke="none"/>
        <path d="M25 24 Q28 20 26 18" stroke="#9E9E9E" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
        <path d="M14 38 Q18 36 22 38 Q26 40 30 38" stroke="#FFF" strokeWidth=".8" fill="none" opacity=".3"/>
        <path d="M22 42 Q24 38 26 36 Q28 34 28 30" stroke="#FFF" strokeWidth="1" fill="none" opacity=".25"/>
        <ellipse cx="26" cy="42" rx="5" ry="2.5" fill="#FFF" opacity=".15"/>
        <circle cx="36" cy="8" r="2" fill="#FFEAA7" opacity=".5"/>
        <circle cx="42" cy="12" r="1" fill="#FFEAA7" opacity=".3"/>
      </svg>);
    case 's4': // Jack and the Beanstalk - beanstalk going up into clouds
      return(<svg {...p}>
        <rect x="16" y="36" width="16" height="8" rx="2" fill="#8B6340" opacity=".4"/>
        <path d="M24 40 Q20 30 22 22 Q24 14 20 8 Q18 4 20 0" stroke="#3DC1A3" strokeWidth="3" fill="none" strokeLinecap="round"/>
        <path d="M24 40 Q28 32 26 24 Q24 16 28 10 Q30 6 28 2" stroke="#55E6C1" strokeWidth="2" fill="none" strokeLinecap="round" opacity=".6"/>
        <ellipse cx="18" cy="28" rx="4" ry="2.5" fill="#3DC1A3" opacity=".5"/>
        <ellipse cx="30" cy="20" rx="4" ry="2.5" fill="#55E6C1" opacity=".4"/>
        <ellipse cx="16" cy="14" rx="3.5" ry="2" fill="#3DC1A3" opacity=".4"/>
        <ellipse cx="10" cy="4" rx="10" ry="5" fill="#C5B3E6" opacity=".3"/>
        <ellipse cx="30" cy="3" rx="12" ry="4" fill="#C5B3E6" opacity=".25"/>
        <ellipse cx="20" cy="6" rx="8" ry="4" fill="#FFF" opacity=".1"/>
        <circle cx="12" cy="2" r="1.5" fill="#FFEAA7" opacity=".5"/>
        <circle cx="38" cy="6" r="1.5" fill="#FFEAA7" opacity=".5"/>
        <circle cx="8" cy="42" r="1" fill="#F5A623" opacity=".5"/>
        <circle cx="40" cy="38" r="1.5" fill="#F5A623" opacity=".4"/>
      </svg>);
    case 's5': // Little Red Riding Hood - red hood in forest path
      return(<svg {...p}>
        <rect x="0" y="38" width="48" height="10" fill="#1A3A1A" opacity=".3"/>
        <path d="M0 38 Q12 34 24 36 Q36 34 48 38" fill="#2A5A2A" opacity=".2"/>
        <path d="M6 38 L6 10" stroke="#5C3D1E" strokeWidth="3"/><ellipse cx="6" cy="8" rx="8" ry="10" fill="#2E7D32" opacity=".5"/>
        <path d="M42 38 L42 12" stroke="#5C3D1E" strokeWidth="3"/><ellipse cx="42" cy="10" rx="7" ry="9" fill="#2E7D32" opacity=".4"/>
        <path d="M16 38 Q24 32 32 38" fill="#D4A76A" opacity=".15"/>
        <path d="M24 38 L24 26" stroke="none"/>
        <ellipse cx="24" cy="30" rx="4" ry="3" fill="#CC3333"/>
        <path d="M20 29 Q24 22 28 29" fill="#CC3333"/>
        <circle cx="24" cy="32" r="3" fill="#FFD4A2"/>
        <circle cx="23" cy="31.5" r=".5" fill="#333"/><circle cx="25.5" cy="31.5" r=".5" fill="#333"/>
        <ellipse cx="24" cy="36" rx="3" ry="4" fill="#CC3333" opacity=".8"/>
        <rect x="22" y="34" width="4" height="2" rx="1" fill="#FFF" opacity=".3"/>
        <circle cx="14" cy="4" r="1.5" fill="#FFEAA7" opacity=".6"/>
      </svg>);
    case 's6': // Tortoise and the Hare - tortoise crossing finish line
      return(<svg {...p}>
        <rect x="0" y="36" width="48" height="12" fill="#3DC1A3" opacity=".1"/>
        <path d="M36 10 L36 36" stroke="#FF7979" strokeWidth="1.5" strokeDasharray="3 2"/>
        <path d="M34 8 L38 8" stroke="#FF7979" strokeWidth="2"/>
        <ellipse cx="16" cy="30" rx="8" ry="6" fill="#5C8A3A"/>
        <path d="M8 30 Q10 22 16 20 Q22 22 24 30" fill="#4A7530" stroke="#3A5A20" strokeWidth=".5"/>
        <path d="M10 26 Q16 23 22 26" stroke="#3A5A20" strokeWidth=".4" fill="none"/>
        <path d="M12 28 Q16 25.5 20 28" stroke="#3A5A20" strokeWidth=".4" fill="none"/>
        <circle cx="8" cy="28" r="3" fill="#7BA55A"/>
        <circle cx="7" cy="27.5" r=".6" fill="#222"/>
        <path d="M5 29 L4 28.5" stroke="#7BA55A" strokeWidth=".5"/>
        <ellipse cx="11" cy="34" rx="2" ry="1" fill="#7BA55A"/><ellipse cx="21" cy="34" rx="2" ry="1" fill="#7BA55A"/>
        <ellipse cx="38" cy="20" rx="4" ry="5" fill="#ABABAB" opacity=".3"/>
        <path d="M36 16 Q38 12 40 16" stroke="#ABABAB" strokeWidth="1" fill="none" opacity=".3"/>
        <text x="34" y="6" fill="#FFEAA7" fontSize="5" fontFamily="Baloo 2,cursive" fontWeight="700" opacity=".6">1st</text>
      </svg>);
    case 's7': // Princess and the Pea - stack of mattresses with pea
      return(<svg {...p}>
        <rect x="10" y="38" width="28" height="3" rx="1" fill="#8B6340"/>
        <rect x="8" y="38" width="2" height="6" fill="#6B4320"/><rect x="38" y="38" width="2" height="6" fill="#6B4320"/>
        <circle cx="24" cy="37" r="1.5" fill="#55E6C1"/>
        <circle cx="24" cy="37" r="2.5" fill="#55E6C1" opacity=".2"/>
        {[0,1,2,3,4,5].map(i=><rect key={i} x={11+i*.3} y={32-i*3} width={26-i*.6} height={2.5} rx="1.2"
          fill={i%2===0?'#C5B3E6':'#FFB8B8'} stroke={i%2===0?'#A78BCC':'#E8A0A0'} strokeWidth=".3" opacity={.7+i*.05}/>)}
        <rect x="13" y="13" width="22" height="2" rx="1" fill="#FFF8DC" opacity=".6"/>
        <ellipse cx="24" cy="12" rx="3" ry="2.5" fill="#FFD4A2"/>
        <circle cx="23" cy="11.5" r=".5" fill="#333"/><circle cx="25.5" cy="11.5" r=".5" fill="#333"/>
        <path d="M21 9 Q24 6 27 9" fill="#C5B3E6"/>
        <circle cx="40" cy="6" r="1.5" fill="#FFEAA7" opacity=".5"/>
        <circle cx="8" cy="8" r="1" fill="#FFEAA7" opacity=".4"/>
      </svg>);
    case 's8': // Stars That Came to Play - playful stars bouncing
      return(<svg {...p}>
        <path d="M24 42 Q26 38 24 36 Q22 34 24 30" stroke="#C5B3E6" strokeWidth="1" fill="none" strokeDasharray="2 1" opacity=".3"/>
        <path d="M12 8 L13.5 13 L18.5 13 L14.5 16 L16 21 L12 18 L8 21 L9.5 16 L5.5 13 L10.5 13Z" fill="#FFEAA7"/>
        <circle cx="12" cy="14.5" r="7" fill="#FFEAA7" opacity=".1"/>
        <circle cx="11" cy="14" r=".6" fill="#333"/><circle cx="13.5" cy="14" r=".6" fill="#333"/>
        <path d="M11 15.5 Q12 16.5 13 15.5" stroke="#333" strokeWidth=".4" fill="none"/>
        <path d="M32 14 L33 17 L36 17 L33.5 19 L34.5 22 L32 20 L29.5 22 L30.5 19 L28 17 L31 17Z" fill="#FFD4A2" opacity=".7"/>
        <path d="M40 6 L40.8 8 L43 8 L41.2 9.3 L42 11.5 L40 10 L38 11.5 L38.8 9.3 L37 8 L39.2 8Z" fill="#C5B3E6" opacity=".6"/>
        <path d="M20 28 L20.6 30 L22.5 30 L21 31 L21.6 33 L20 31.8 L18.4 33 L19 31 L17.5 30 L19.4 30Z" fill="#55E6C1" opacity=".5"/>
        <rect x="18" y="36" width="12" height="8" rx="1" fill="#2A1F5E" opacity=".3"/>
        <rect x="20" y="37" width="3" height="5" fill="#4A7FB5" opacity=".2"/><rect x="25" y="37" width="3" height="5" fill="#4A7FB5" opacity=".2"/>
      </svg>);
    case 's9': // Snow White - poisoned apple with mirror
      return(<svg {...p}>
        <ellipse cx="30" cy="26" rx="10" ry="11" fill="#CC3333"/>
        <ellipse cx="30" cy="26" rx="9" ry="10" fill="#E84444"/>
        <path d="M30 16 Q32 12 34 16" stroke="#5C3D1E" strokeWidth="1" fill="none"/>
        <ellipse cx="30" cy="16.5" rx="2" ry="1" fill="#3DC1A3" opacity=".6"/>
        <ellipse cx="33" cy="22" rx="3" ry="2" fill="#FF6666" opacity=".4"/>
        <path d="M26 32 Q30 36 34 32" fill="#AA2222" opacity=".3"/>
        <ellipse cx="14" cy="20" rx="9" ry="12" fill="#C5B3E6" opacity=".2" stroke="#A78BCC" strokeWidth=".8"/>
        <ellipse cx="14" cy="20" rx="7" ry="10" fill="#1A1345" opacity=".3"/>
        <path d="M11 17 Q14 14 17 17" stroke="#FFF" strokeWidth=".5" fill="none" opacity=".3"/>
        <circle cx="12" cy="20" r=".5" fill="#FFF" opacity=".3"/><circle cx="16" cy="20" r=".5" fill="#FFF" opacity=".3"/>
        <path d="M12 22 Q14 23.5 16 22" stroke="#FFF" strokeWidth=".4" fill="none" opacity=".3"/>
        <circle cx="6" cy="6" r="1.5" fill="#FFEAA7" opacity=".5"/>
        <circle cx="42" cy="8" r="1" fill="#FFEAA7" opacity=".4"/>
      </svg>);
    case 's10': // Cinderella - glass slipper with sparkles
      return(<svg {...p}>
        <path d="M8 36 Q8 28 16 26 L30 26 Q34 26 36 30 Q38 34 40 36 L44 36 Q44 40 40 40 L12 40 Q8 40 8 36Z" fill="#87CEEB" opacity=".4" stroke="#5BACDB" strokeWidth=".5"/>
        <path d="M8 36 Q8 28 16 26 L30 26 Q34 26 36 30 Q38 34 40 36" fill="none" stroke="#FFF" strokeWidth=".3" opacity=".5"/>
        <path d="M16 26 Q20 22 18 18" stroke="#5BACDB" strokeWidth="1" fill="none" strokeLinecap="round"/>
        <path d="M12 34 Q20 30 28 34" stroke="#FFF" strokeWidth=".3" opacity=".3"/>
        <ellipse cx="36" cy="38" rx="4" ry="1" fill="#5BACDB" opacity=".15"/>
        <path d="M14 10 L15 13 L18 13 L15.5 15 L16.5 18 L14 16 L11.5 18 L12.5 15 L10 13 L13 13Z" fill="#FFEAA7" opacity=".7"/>
        <path d="M34 8 L34.8 10.5 L37 10.5 L35.2 12 L36 14.5 L34 13 L32 14.5 L32.8 12 L31 10.5 L33.2 10.5Z" fill="#C5B3E6" opacity=".6"/>
        <circle cx="24" cy="6" r="1" fill="#FFF" opacity=".5"/>
        <circle cx="40" cy="14" r=".8" fill="#FFEAA7" opacity=".4"/>
        <path d="M26 16 L26.5 17.5 L28 17.5 L27 18.5 L27.3 20 L26 19 L24.7 20 L25 18.5 L24 17.5 L25.5 17.5Z" fill="#55E6C1" opacity=".5"/>
      </svg>);
    case 's11': // Sleeping Beauty - rose with thorns and spinning wheel
      return(<svg {...p}>
        <circle cx="32" cy="28" r="10" fill="none" stroke="#8B6340" strokeWidth="1.5"/>
        <circle cx="32" cy="28" r="1.5" fill="#8B6340"/>
        <line x1="32" y1="18" x2="32" y2="24" stroke="#8B6340" strokeWidth=".8"/>
        <line x1="32" y1="32" x2="32" y2="38" stroke="#8B6340" strokeWidth=".8"/>
        <line x1="22" y1="28" x2="28" y2="28" stroke="#8B6340" strokeWidth=".8"/>
        <line x1="36" y1="28" x2="42" y2="28" stroke="#8B6340" strokeWidth=".8"/>
        <line x1="25" y1="21" x2="29" y2="25" stroke="#8B6340" strokeWidth=".6"/>
        <line x1="35" y1="31" x2="39" y2="35" stroke="#8B6340" strokeWidth=".6"/>
        <line x1="32" y1="14" x2="32" y2="12" stroke="#8B6340" strokeWidth="1"/>
        <circle cx="32" cy="11" r="1" fill="#C9A96E"/>
        <circle cx="14" cy="20" r="5" fill="#E84444" opacity=".8"/>
        <circle cx="12" cy="18" r="3.5" fill="#CC3333"/>
        <circle cx="16" cy="17" r="3" fill="#E84444" opacity=".6"/>
        <circle cx="14" cy="22" r="3" fill="#CC3333" opacity=".7"/>
        <path d="M14 26 Q13 32 14 38" stroke="#3DC1A3" strokeWidth="1.5" fill="none"/>
        <path d="M13 30 L11 28" stroke="#3DC1A3" strokeWidth=".8"/><path d="M15 34 L17 32" stroke="#3DC1A3" strokeWidth=".8"/>
        <ellipse cx="14" cy="15" rx="2.5" ry="1.5" fill="#3DC1A3" opacity=".5"/>
        <circle cx="6" cy="6" r="1" fill="#FFEAA7" opacity=".5"/>
      </svg>);
    case 's12': // Hansel and Gretel - gingerbread house
      return(<svg {...p}>
        <path d="M8 24 L24 8 L40 24" fill="#C9A96E" stroke="#8B6340" strokeWidth=".5"/>
        <rect x="10" y="24" width="28" height="18" rx="1" fill="#D4A76A" stroke="#8B6340" strokeWidth=".5"/>
        <circle cx="16" cy="14" r="2" fill="#FF7979" opacity=".7"/>
        <circle cx="32" cy="14" r="2" fill="#55E6C1" opacity=".7"/>
        <circle cx="24" cy="12" r="1.5" fill="#FFEAA7" opacity=".7"/>
        <path d="M8 24 L24 8 L40 24" fill="none" stroke="#FFF" strokeWidth="1" strokeDasharray="2 2" opacity=".3"/>
        <rect x="14" y="28" width="6" height="6" rx=".5" fill="#FFB8B8" opacity=".5" stroke="#E8A0A0" strokeWidth=".3"/>
        <line x1="17" y1="28" x2="17" y2="34" stroke="#E8A0A0" strokeWidth=".3"/>
        <line x1="14" y1="31" x2="20" y2="31" stroke="#E8A0A0" strokeWidth=".3"/>
        <rect x="28" y="28" width="6" height="6" rx=".5" fill="#C5B3E6" opacity=".5" stroke="#A78BCC" strokeWidth=".3"/>
        <line x1="31" y1="28" x2="31" y2="34" stroke="#A78BCC" strokeWidth=".3"/>
        <line x1="28" y1="31" x2="34" y2="31" stroke="#A78BCC" strokeWidth=".3"/>
        <rect x="20" y="34" width="8" height="8" rx="4" fill="#8B6340"/>
        <circle cx="26" cy="37" r="1" fill="#F5A623"/>
        <circle cx="12" cy="36" r="1.5" fill="#FF7979" opacity=".5"/>
        <circle cx="36" cy="36" r="1.5" fill="#55E6C1" opacity=".5"/>
        <circle cx="24" cy="20" r="1" fill="#FFEAA7" opacity=".5"/>
        <path d="M6 24 Q4 22 6 20" stroke="#3DC1A3" strokeWidth="1" fill="none" opacity=".3"/>
        <path d="M42 24 Q44 22 42 20" stroke="#3DC1A3" strokeWidth="1" fill="none" opacity=".3"/>
      </svg>);
    default: return <Icon name="book" size={size} color="var(--lav)"/>;
  }
}

// IndexedDB
const DB='tailatale';const DBV=3;
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB,DBV);r.onupgradeneeded=e=>{const db=e.target.result;if(!db.objectStoreNames.contains('voices'))db.createObjectStore('voices',{keyPath:'id'});if(!db.objectStoreNames.contains('audioCache'))db.createObjectStore('audioCache',{keyPath:'key'});if(!db.objectStoreNames.contains('translations'))db.createObjectStore('translations',{keyPath:'key'});if(!db.objectStoreNames.contains('customStories'))db.createObjectStore('customStories',{keyPath:'id'})};r.onsuccess=e=>res(e.target.result);r.onerror=e=>rej(e)})}
async function dbPut(s,d){const db=await openDB();return new Promise((res,rej)=>{const tx=db.transaction(s,'readwrite');tx.objectStore(s).put(d);tx.oncomplete=()=>res();tx.onerror=e=>rej(e)})}
async function dbGet(s,k){const db=await openDB();return new Promise((res,rej)=>{const tx=db.transaction(s,'readonly');const r=tx.objectStore(s).get(k);r.onsuccess=()=>res(r.result||null);r.onerror=e=>rej(e)})}
async function dbDel(s,k){const db=await openDB();return new Promise(res=>{const tx=db.transaction(s,'readwrite');tx.objectStore(s).delete(k);tx.oncomplete=()=>res()})}
async function dbGetAll(s){const db=await openDB();return new Promise((res,rej)=>{const tx=db.transaction(s,'readonly');const r=tx.objectStore(s).getAll();r.onsuccess=()=>res(r.result||[]);r.onerror=e=>rej(e)})}

// Translation via MyMemory free API (cached in IndexedDB)
async function translateText(text,from,to){
  if(from===to)return text;
  const key=`${from}_${to}_${hashCode(text)}`;
  const cached=await dbGet('translations',key);
  if(cached)return cached.text;
  try{
    const chunks=text.split('\n\n');const translated=[];
    for(const chunk of chunks){
      const r=await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(chunk)}&langpair=${from}|${to}`);
      const d=await r.json();translated.push(d?.responseData?.translatedText||chunk);
      await new Promise(r=>setTimeout(r,500));
    }
    const result=translated.join('\n\n');
    await dbPut('translations',{key,text:result,from,to,ts:Date.now()});
    return result;
  }catch(e){console.warn('Translation failed:',e);return text}
}
function hashCode(s){let h=0;for(let i=0;i<s.length;i++)h=(h*31+s.charCodeAt(i))&0x7fffffff;return h.toString(36)}

// Chatterbox TTS
const HF_SPACE="ResembleAI/Chatterbox";let gradioClient=null;let gradioLock=false;
async function initGradio(){
  if(gradioClient)return gradioClient;
  if(!window.__gradio){await new Promise(res=>{if(window.__gradio)return res();window.addEventListener('gradio-ready',res,{once:true});setTimeout(res,10000)})}
  if(!window.__gradio)return null;
  try{gradioClient=await window.__gradio.Client.connect(HF_SPACE);console.log('Connected to Chatterbox');return gradioClient}catch(e){console.warn('Chatterbox fail:',e);return null}
}
async function acquireLock(){while(gradioLock){await new Promise(r=>setTimeout(r,500))}gradioLock=true}
function releaseLock(){gradioLock=false}
async function generateChunk(text,voiceBlob){
  await acquireLock();
  try{
    const client=await initGradio();if(!client||!window.__gradio)throw new Error('TTS unavailable');
    const voiceFile=new File([voiceBlob],'voice.wav',{type:voiceBlob.type||'audio/wav'});
    const audioFile=window.__gradio.handle_file(voiceFile);
    console.log('[TTS] Sending:',text.substring(0,50)+'... voice:',voiceFile.size,'bytes',voiceFile.type);
    const result=await client.predict("/generate_tts_audio",[text,audioFile,0.4,0.8,0,0.4]);
    console.log('[TTS] Result type:',typeof result?.data?.[0],JSON.stringify(result?.data?.[0]).substring(0,150));
    if(result?.data?.[0]){
      const ad=result.data[0];let url=null;
      if(typeof ad==='object'&&ad.url)url=ad.url;
      else if(typeof ad==='string'&&ad.startsWith('http'))url=ad;
      else if(typeof ad==='object'&&ad.path){const base=client.config?.root||'https://huggingface.co/spaces/'+HF_SPACE;url=ad.path.startsWith('http')?ad.path:base+'/file='+ad.path}
      if(url){console.log('[TTS] Fetching audio from:',url);const r=await fetch(url);if(!r.ok)throw new Error('Fetch failed: '+r.status);const blob=await r.blob();console.log('[TTS] Audio blob:',blob.size,'bytes',blob.type);return blob}
      if(ad instanceof Blob)return ad;
    }
    throw new Error('No audio returned');
  }finally{releaseLock()}
}
function chunkText(text,maxLen=280){const sentences=text.match(/[^.!?]+[.!?]+[\s"]*/g)||[text];const chunks=[];let cur='';for(const s of sentences){if((cur+s).length>maxLen&&cur){chunks.push(cur.trim());cur=s}else cur+=s}if(cur.trim())chunks.push(cur.trim());return chunks}

// Voice pre-warm: wake GPU + validate voice right after recording
let preWarmStatus={active:false,done:false,error:false};let preWarmListeners=[];
function onPreWarmChange(fn){preWarmListeners.push(fn);return()=>{preWarmListeners=preWarmListeners.filter(f=>f!==fn)}}
function notifyPreWarm(){preWarmListeners.forEach(fn=>fn({...preWarmStatus}))}
async function preWarmVoice(voiceId){
  preWarmStatus={active:true,done:false,error:false};notifyPreWarm();
  try{
    const d=await dbGet('voices',voiceId);if(!d?.blob)throw new Error('No voice');
    console.log('Pre-warming voice clone...');
    await generateChunk("Once upon a time, in a land far away, the stars twinkled softly.",d.blob);
    preWarmStatus={active:false,done:true,error:false};notifyPreWarm();
    console.log('Voice pre-warm complete!');
  }catch(e){
    console.warn('Pre-warm failed (GPU may still be cold):',e);
    preWarmStatus={active:false,done:false,error:true};notifyPreWarm();
  }
}

// Stories - each has txS (short ~2-3min) and txL (long ~6-8min)
const S=[
{id:'s1',t:'The Three Little Pigs',a:'Traditional',c:'fairytale',age:'3-6',mS:2,mL:6,
txS:"Once upon a time, three little pigs left home to build their own houses. The first pig built a straw house. The second pig built a stick house. The third pig built a strong brick house.\n\nA big bad wolf came and blew down the straw house! The pig ran to his brother. The wolf blew down the stick house too! Both pigs ran to the brick house.\n\nThe wolf huffed and puffed, but he could NOT blow down the brick house! He tried the chimney, but the smart pig had hot water waiting. The wolf ran away forever.\n\nThe three pigs lived happily ever after. The End.",
txL:"Once upon a time, there were three little pigs who lived with their mother in a cozy cottage at the edge of a meadow. One sunny morning, their mother called them together. \"My dear little pigs, you are all grown up now. It is time for you to go out into the world and build your own houses.\"\n\nShe packed each pig a little lunch and kissed them goodbye. \"Remember,\" she said, \"always do your very best work.\"\n\nThe first little pig was very lazy. He found a farmer selling straw and thought, \"This will be easy!\" He piled up the straw, tied it together, and in just one afternoon, his house was done. \"This will do just fine!\" he said, and spent the rest of the day playing in the sunshine.\n\nThe second little pig was a bit more careful. He gathered sticks from the forest and wove them together. It took him two days. \"Good enough for me!\" he said happily.\n\nBut the third little pig was the wisest of all. He bought bricks and mortar and spent many long days building his house. His brothers laughed at him. \"Why work so hard?\" they teased. But the third pig kept building. He added a strong door, a fireplace, and even a chimney.\n\nOne chilly evening, a big bad wolf came creeping through the woods. He spotted the straw house and licked his lips. \"Little pig, little pig, let me come in!\" he growled.\n\n\"Not by the hair on my chinny chin chin!\" squealed the first pig.\n\n\"Then I'll huff, and I'll puff, and I'll BLOW your house down!\" And he did just that! The straw flew everywhere, and the first pig ran squealing to his brother's stick house.\n\nThe wolf followed. \"Little pigs, little pigs, let me come in!\" \"Not by the hair on our chinny chin chins!\" So the wolf huffed, and he puffed, and he BLEW the stick house down too! Both pigs ran as fast as their little legs could carry them to the brick house.\n\nThe wolf was right behind them. \"Little pigs, little pigs, let me come in!\" \"Not by the hair on our chinny chin chins!\" roared all three pigs together.\n\nThe wolf huffed. And he puffed. And he huffed and puffed some more. But the brick house stood perfectly still! Not a single brick moved.\n\nThe wolf had one more idea. He climbed onto the roof and started sliding down the chimney. But the clever third pig had a big pot of hot water bubbling over the fire. SPLASH! The wolf yelped, jumped right back out, and ran away into the forest, never to be seen again.\n\nThe three pigs danced and celebrated. From that day on, they all lived together in the strong brick house, safe and happy. And the first two pigs learned that it always pays to do your very best work.\n\nThe End."},
{id:'s2',t:'Goldilocks and the Three Bears',a:'Robert Southey',c:'fairytale',age:'3-6',mS:2,mL:7,
txS:"Once upon a time, a girl named Goldilocks found a cottage in the forest. Inside were three bowls of porridge. The big one was too hot, the medium one too cold, but the little one was just right!\n\nShe tried three chairs. Too hard, too soft, just right! But it broke. She tried three beds. Too hard, too soft, just right! She fell asleep.\n\nThe three bears came home and found her. Goldilocks woke up, saw them, and ran all the way home. She never went into anyone's house without asking again. The End.",
txL:"Once upon a time, at the edge of a great green forest, there lived three bears in a neat little cottage. There was great big Papa Bear, medium-sized Mama Bear, and tiny little Baby Bear. Every morning, Mama Bear made porridge for breakfast.\n\nOne particular morning, the porridge was far too hot to eat. \"Let's go for a walk while it cools down,\" suggested Papa Bear in his great big voice. And off they went, leaving their door unlocked, as bears often do.\n\nNow, not far away, a curious little girl named Goldilocks was wandering through the forest, picking wildflowers. She had golden curls that bounced as she walked, and a nose for adventure that sometimes got her into trouble.\n\nShe spotted the bears' cottage and peeked through the window. \"How lovely!\" she said. She knocked on the door. No answer. So she let herself right in.\n\nOn the table sat three bowls of porridge. Goldilocks was very hungry. She tasted Papa Bear's porridge. \"Ouch! Too hot!\" She tasted Mama Bear's porridge. \"Brrr! Too cold!\" Then she tasted Baby Bear's porridge. \"Mmm, just right!\" She ate every last spoonful.\n\nIn the living room stood three chairs. She sat in Papa Bear's chair. \"Too hard!\" She sat in Mama Bear's chair. \"Too soft!\" She sat in Baby Bear's chair. \"Just right!\" But she rocked back and forth so much that CRACK! The little chair broke into pieces.\n\nFeeling sleepy, Goldilocks went upstairs and found three beds. She lay on Papa Bear's bed. \"Too hard!\" She lay on Mama Bear's bed. \"Too soft!\" She lay on Baby Bear's bed. \"Just right!\" And she fell fast asleep, snoring softly.\n\nSoon the three bears came home from their walk. Papa Bear looked at his bowl. \"Someone's been eating my porridge!\" he growled. Mama Bear looked at hers. \"Someone's been eating my porridge too!\" Baby Bear looked at his empty bowl and cried, \"Someone's been eating my porridge, and they ate it ALL up!\"\n\nThey went to the living room. \"Someone's been sitting in my chair!\" said Papa Bear. \"Someone's been sitting in my chair!\" said Mama Bear. \"Someone's been sitting in my chair,\" sobbed Baby Bear, \"and they BROKE it!\"\n\nUpstairs they went. \"Someone's been sleeping in my bed!\" rumbled Papa Bear. \"Someone's been sleeping in my bed!\" said Mama Bear. \"Someone's been sleeping in my bed,\" squeaked Baby Bear, \"and SHE'S STILL THERE!\"\n\nGoldilocks woke up with a start. She saw three bears staring at her with three pairs of wide eyes. She screamed, jumped out of the window, and ran all the way home without stopping once.\n\nAnd from that day on, Goldilocks never ever went into anyone's house without being invited first. And the bears? They got a new lock for their door.\n\nThe End."},
{id:'s3',t:'The Ugly Duckling',a:'H.C. Andersen',c:'fairytale',age:'4-8',mS:2,mL:6,
txS:"Once upon a time, a mother duck's eggs hatched. All the ducklings were fluffy and yellow, except the last one. He was big and grey.\n\nEveryone called him ugly. The poor duckling ran away. He spent a long, cold winter all alone.\n\nWhen spring came, he flew to a lake and saw beautiful swans. He looked at his reflection and gasped. He was a beautiful swan too!\n\nThe other swans welcomed him with joy. He had been a swan all along. The End.",
txL:"Once upon a time, by a peaceful pond surrounded by tall reeds and swaying cattails, a mother duck sat patiently on her nest. One by one, her eggs began to crack. Pop! Pop! Pop! Out tumbled fluffy yellow ducklings, peeping and cheeping with delight.\n\nBut the biggest egg hadn't hatched yet. Mother Duck waited and waited. Finally, CRACK! Out came the last duckling. He was much bigger than the others, with grey feathers and large, clumsy feet.\n\n\"Oh my,\" said Mother Duck, trying to be kind. But the other animals were not so gentle. \"What an ugly duckling!\" clucked the hens. \"He doesn't look like a duck at all!\" quacked the other ducks. Even his brothers and sisters waddled away from him.\n\nEvery day, someone had something mean to say. The cat hissed at him. The turkey gobbled at him. Even the girl who fed the ducks shooed him away. The ugly duckling's heart was heavy with sadness.\n\nOne autumn evening, he saw a flock of magnificent white birds flying across the orange sky. They were the most beautiful creatures he had ever seen, with long graceful necks and wings like silk. Something stirred deep inside him, though he didn't know why.\n\n\"I wish I could be like them,\" he whispered.\n\nWinter came, cold and cruel. The pond froze over. The duckling had to paddle all night long to keep a small circle of water from turning to ice. He was tired, hungry, and desperately lonely. A kind farmer found him and brought him inside, but the farmer's children scared him, and he escaped back into the bitter cold.\n\nSlowly, slowly, the days grew longer. The ice melted. The flowers pushed through the earth. Spring had finally arrived.\n\nThe duckling felt stronger than ever before. He spread his wings, and to his amazement, they were large and powerful. He flew! Really flew! He soared over meadows and forests until he landed on a sparkling lake.\n\nThree beautiful white swans glided toward him. The duckling bowed his head, expecting them to chase him away. But then he saw his reflection in the clear water.\n\nStaring back at him was not an ugly grey duckling. It was a beautiful white swan, with a long graceful neck and gleaming feathers.\n\n\"Welcome, brother!\" called the swans. Children on the shore pointed and cheered. \"Look! The new swan is the most beautiful of all!\"\n\nThe young swan ruffled his magnificent feathers. After all the sadness and loneliness, he had found where he truly belonged. He had been a swan all along, and now the whole world could see it.\n\nThe End."},
{id:'s4',t:'Jack and the Beanstalk',a:'Traditional',c:'fairytale',age:'4-8',mS:2,mL:7,
txS:"Once upon a time, poor Jack traded his cow for magic beans. His mother threw them out the window in anger.\n\nBy morning, a giant beanstalk reached into the clouds! Jack climbed up and found a giant's castle. He grabbed a bag of gold and escaped.\n\nHe climbed again for a golden hen, and once more for a magic harp. But the giant chased him! Jack slid down and chopped the beanstalk. The giant fell and never returned.\n\nJack and his mother lived happily ever after. The End.",
txL:"Once upon a time, there lived a poor boy named Jack with his mother in a tiny cottage. They had nothing left to eat, and their only cow, Milky White, had stopped giving milk.\n\n\"You must take her to market and sell her,\" said Jack's mother with tears in her eyes. So Jack set off down the road with Milky White.\n\nOn the way, he met a strange old man. \"I'll trade you these magic beans for your cow,\" said the man, holding out five shimmering beans that sparkled like tiny stars.\n\nJack thought they were wonderful and made the trade. But when he got home, his mother was furious. \"Magic beans? You foolish boy!\" She threw the beans out the window and sent Jack to bed without supper.\n\nBut in the morning, Jack rubbed his eyes in amazement. Outside his window grew an enormous beanstalk, so tall it disappeared into the clouds above! Its leaves were as big as blankets, and its trunk was as thick as a tree.\n\nJack began to climb. Up, up, up he went, past the birds, past the clouds, until he reached a strange land floating in the sky. Before him stood an enormous castle.\n\nJack crept inside. Everything was giant-sized. The tables were as tall as houses, the chairs as big as rooms. Suddenly, the floor shook. BOOM. BOOM. BOOM.\n\n\"Fee-fi-fo-fum! I smell the blood of an Englishman!\" roared a terrible voice. A huge giant stomped into the room! Jack hid inside a teacup just in time.\n\nThe giant sat down and counted bags of gold coins. When he fell asleep, his snores shaking the walls, Jack grabbed a bag of gold and scrambled down the beanstalk as fast as he could.\n\nHis mother could hardly believe it! They bought food, new clothes, and fixed up their cottage. But soon the gold ran out.\n\nSo Jack climbed the beanstalk again. This time he found a hen that laid golden eggs! He tucked her under his arm and climbed back down. Now they would never be poor again.\n\nBut Jack was brave and curious, so he climbed one more time. In the castle he found a beautiful golden harp that played the sweetest music all by itself. Jack picked it up, but the harp cried out, \"Master! Master!\"\n\nThe giant woke with a roar! \"Fee-fi-fo-fum!\" He chased Jack across the castle, through the great hall, out the door, and to the beanstalk.\n\nJack climbed down faster than he ever had before. The giant followed, and the whole beanstalk swayed and shook. \"Mother, bring the axe!\" Jack shouted.\n\nAs soon as his feet touched the ground, Jack swung the axe with all his might. CHOP! CHOP! CHOP! The beanstalk cracked, groaned, and came crashing down. The giant fell far, far away and was never seen again.\n\nJack, his mother, the golden hen, and the magical harp all lived happily and richly ever after.\n\nThe End."},
{id:'s5',t:'Little Red Riding Hood',a:'Brothers Grimm',c:'fairytale',age:'4-7',mS:2,mL:6,
txS:"Once upon a time, Little Red Riding Hood went to visit her sick grandmother. In the forest, a sneaky wolf asked where she was going, then ran ahead.\n\nAt grandmother's house, the wolf pretended to be her. \"What big eyes you have!\" \"All the better to see you with!\" \"What big teeth you have!\" \"All the better to catch you!\"\n\nA brave woodcutter heard the commotion and chased the wolf away. Grandmother was safe. Red Riding Hood always stayed on the path after that. The End.",
txL:"Once upon a time, in a little village at the edge of a dark forest, there lived a sweet girl who always wore a beautiful red hooded cape that her grandmother had made for her. Everyone called her Little Red Riding Hood.\n\nOne morning, her mother packed a basket with fresh bread, butter, and a jar of honey. \"Your grandmother is feeling poorly,\" said her mother. \"Please take this to her. But remember: stay on the path and don't talk to strangers.\"\n\n\"I promise, Mother,\" said Little Red Riding Hood, and off she went, skipping into the forest.\n\nThe forest was beautiful. Sunlight danced through the leaves, and birds sang in the branches. But deeper in, the trees grew taller and the shadows grew darker.\n\nSuddenly, a wolf stepped out from behind a tree. He had sharp teeth and cunning eyes, but he smiled his friendliest smile. \"Good morning, little girl. Where are you going with that lovely basket?\"\n\n\"To my grandmother's cottage on the other side of the forest,\" said Red Riding Hood. \"She's not feeling well.\"\n\n\"How kind of you!\" said the wolf. \"Why don't you pick some of these beautiful flowers for her? They would surely make her feel better.\" And he pointed to a patch of wildflowers off the path.\n\nWhile Red Riding Hood gathered flowers, forgetting her mother's warning, the wolf raced ahead to grandmother's cottage. He knocked on the door. \"It's me, Grandmother! Little Red Riding Hood!\"\n\n\"Come in, dear!\" called the grandmother. The wolf burst in, and the frightened grandmother quickly hid in the wardrobe closet.\n\nThe wolf put on grandmother's nightcap and glasses, pulled the covers up to his chin, and climbed into bed.\n\nSoon, Little Red Riding Hood arrived and knocked on the door. \"Come in!\" called a strange, gruff voice. She stepped inside. Something didn't look quite right.\n\n\"Grandmother, what big eyes you have!\" \"All the better to see you with, my dear.\" \"Grandmother, what big ears you have!\" \"All the better to hear you with, my dear.\" \"Grandmother, what big teeth you have!\" \"All the better to CATCH you with!\"\n\nThe wolf leaped out of bed! Little Red Riding Hood screamed as loud as she could.\n\nA brave woodcutter was working nearby. He heard the scream, burst through the door, and swung his mighty axe. The wolf was so frightened he jumped right out the window and ran away into the deepest, darkest part of the forest, never to return.\n\nGrandmother came out of the wardrobe, and they all shared the bread and honey together. From that day on, Little Red Riding Hood always, always stayed on the path.\n\nThe End."},
{id:'s6',t:'The Tortoise and the Hare',a:'Aesop',c:'fable',age:'3-7',mS:1,mL:5,
txS:"A hare bragged that no one could beat him in a race. A slow tortoise accepted the challenge.\n\nThe race started. The hare ran far ahead, then took a nap. The tortoise just kept walking, step by step.\n\nWhen the hare woke up, the tortoise was already at the finish line! Slow and steady wins the race. The End.",
txL:"Once upon a time, in a sunny meadow, there lived a hare who was the fastest animal anyone had ever seen. He could zip through the fields like lightning and leap over streams in a single bound. And oh, how he loved to brag about it!\n\n\"I am the fastest creature in the whole world!\" the hare would boast every single day. \"No one can beat me! Not the fox, not the deer, not anyone!\"\n\nAll the animals were tired of hearing it. Then one day, a quiet little tortoise slowly raised his head. \"I'll race you,\" he said calmly.\n\nThe hare nearly fell over laughing. \"You? Race ME? That's the funniest thing I've ever heard! Your legs are shorter than my ears!\"\n\n\"Nevertheless,\" said the tortoise, \"I challenge you to a race.\"\n\nThe fox agreed to judge, and all the animals gathered to watch. The course ran from the old oak tree to the big red barn on the hill.\n\n\"On your marks, get set, GO!\" shouted the fox.\n\nThe hare shot off like a rocket! In seconds, he was far ahead, just a blur of brown fur. The tortoise took his first careful step. Then another. And another.\n\nThe hare looked back and laughed. The tortoise was barely past the starting line! \"This is too easy,\" said the hare. \"I have plenty of time.\" He spotted a nice shady spot under a tree and decided to take a little rest. Just a short nap.\n\nThe warm sun, the gentle breeze, and the soft grass were so comfortable that the hare fell into a deep, deep sleep.\n\nMeanwhile, the tortoise kept walking. Step by step. One foot in front of the other. He didn't stop. He didn't complain. He didn't look at how far he still had to go. He just kept moving forward.\n\nThe sun moved across the sky. The shadows grew longer. The tortoise passed the sleeping hare without making a sound. He just kept walking.\n\nFinally, the hare woke up with a start. He stretched and yawned. \"Better finish this race, I suppose.\" He looked toward the barn, expecting to see the empty path.\n\nBut there, just steps from the finish line, was the tortoise!\n\nThe hare ran as fast as he could, his ears flat against his head, his legs a blur. But it was too late. The tortoise crossed the finish line just as the hare arrived, huffing and puffing.\n\nAll the animals cheered! The tortoise smiled his slow, wise smile.\n\n\"How did you beat me?\" gasped the hare.\n\n\"Slow and steady wins the race,\" said the tortoise simply.\n\nAnd from that day on, the hare never bragged again. Well, almost never.\n\nThe End."},
{id:'s7',t:'The Princess and the Pea',a:'H.C. Andersen',c:'fairytale',age:'4-8',mS:2,mL:5,
txS:"A prince wanted to marry a real princess, but he could never be sure the princesses he met were real.\n\nOne stormy night, a girl knocked on the castle door, soaking wet. The clever queen placed a tiny pea under twenty mattresses. The girl slept terribly.\n\n\"Only a real princess could feel that!\" said the queen. The prince was overjoyed. They married and lived happily ever after. The End.",
txL:"Once upon a time, there was a prince who wanted very much to marry a real princess. He traveled all around the world, to every kingdom and every land, but something was always wrong. There were plenty of princesses, but he could never be sure if they were real princesses.\n\nOne had dirty fingernails. Another yawned during the royal feast. A third one was perfectly lovely but kept calling the prince by the wrong name. He came home feeling very sad.\n\nThen one evening, a terrible storm blew in. Thunder crashed, lightning flashed, and rain poured down in sheets. In the middle of this dreadful weather, there came a knocking at the castle gate. The old king himself went to open it.\n\nThere stood a girl, absolutely soaked from head to toe. Water ran down her hair and into her shoes. She looked quite a mess. Yet she claimed to be a real princess.\n\n\"We'll see about that,\" thought the old queen, but she said nothing. She went quietly to the guest bedroom, removed all the bedding, and placed a single tiny green pea on the bare mattress. Then she piled twenty thick mattresses on top of the pea, and twenty soft quilts on top of the mattresses.\n\nThe girl had to climb a ladder to get into bed! It was so high she could barely see the floor.\n\nIn the morning, the queen asked sweetly, \"Did you sleep well, my dear?\"\n\n\"Oh, it was terrible!\" said the girl. \"I hardly closed my eyes all night. Something terribly hard was in the bed! I'm covered in bruises. It was quite dreadful!\"\n\nThe queen clapped her hands with delight. Only a real princess could have skin so delicate that she could feel a tiny pea through twenty mattresses and twenty quilts! This was truly a princess!\n\nThe prince was overjoyed. He had finally found his real princess! They were married in a grand ceremony with dancing, feasting, and fireworks that lit up the sky.\n\nAnd the pea? It was placed in the royal museum, where it can still be seen today, if nobody has taken it.\n\nThe End."},
{id:'s8',t:'The Stars That Came to Play',a:'Tail a Tale Original',c:'bedtime',age:'2-5',mS:1,mL:5,
txS:"High in the sky, little star Twinkle didn't want to sleep. She bounced from cloud to cloud.\n\nThen she saw a child by a window. \"Where's my favorite star?\" Twinkle flew to her spot and shone bright.\n\n\"Goodnight, little star!\" said the child. Twinkle smiled. Shining for someone who loves you is the best kind of playing. Goodnight, everyone. The End.",
txL:"High, high up in the velvet night sky, past the fluffy clouds and the sleepy birds, lived a family of stars. There was Papa Star, big and bright. Mama Star, warm and golden. And little Twinkle, the smallest star of all.\n\nEvery evening, when the sun went to sleep and painted the sky pink and purple, it was time for the stars to come out and shine. Papa Star would stretch his five points and glow steadily. Mama Star would shimmer with a soft, golden light. And all the little stars would take their places and twinkle quietly.\n\nBut tonight, little Twinkle didn't want to stay in her spot. \"I don't want to sleep!\" she said. \"I want to PLAY!\"\n\nShe bounced from cloud to cloud, leaving sparkly trails behind her like a tiny comet. She slid down a moonbeam. She played hide-and-seek behind the sleepy moon, who yawned and said, \"Now, now, little one.\"\n\nTwinkle giggled and danced across the sky. She made friends with a firefly who had flown too high. She drew swirly patterns in the darkness. She even tickled the Northern Lights until they wiggled and changed colors.\n\nBut then Twinkle looked down, far, far below. In a tiny house, by a tiny window, she saw a tiny child looking up at the sky. The child looked sad.\n\n\"Where's my favorite star?\" whispered the child. \"The little one that twinkles just for me?\"\n\nTwinkle felt warm inside, right in the center of her starry heart. She realized something important. She flew as fast as she could back to her special spot in the sky. She took a deep breath and shone as bright as she possibly could. She twinkled and sparkled with all her might.\n\nThe child's face lit up with the biggest smile. \"There you are! There's my star! Goodnight, little star! I love you!\"\n\n\"Goodnight,\" whispered Twinkle, glowing with happiness.\n\nTwinkle realized that shining for someone who loves you is the very best kind of playing in the whole wide sky.\n\nSo she settled into her cozy spot, twinkling softly, watching over the sleeping child below. One by one, the other little stars settled down too. The moon pulled a cloud blanket over his face.\n\nGoodnight, little ones. Goodnight, stars. Goodnight, fireflies. Goodnight, moon. Goodnight, Twinkle.\n\nThe End."},
{id:'s9',t:'Snow White',a:'Brothers Grimm',c:'fairytale',age:'4-8',mS:3,mL:8,
txS:"Once upon a time, Snow White's vain stepmother asked her magic mirror who was the fairest. When the mirror said Snow White, the Queen sent her into the forest.\n\nSnow White found a cottage belonging to seven kind dwarfs who let her stay. But the wicked Queen found her and tricked her with a poisoned apple. Snow White fell into a deep sleep.\n\nThe dwarfs kept watch over her. One day, a prince found her and kissed her forehead. Snow White woke up! They married and lived happily ever after. The End.",
txL:"Once upon a time, in a castle atop a snowy hill, there lived a beautiful princess named Snow White. Her skin was as white as snow, her lips as red as roses, and her hair as black as ebony wood. She was kind to every creature she met, from the tiniest mouse to the tallest horse.\n\nBut Snow White's stepmother, the Queen, was terribly vain. She owned a magic mirror, and every morning she would stand before it and ask, \"Mirror, mirror, on the wall, who is the fairest one of all?\"\n\nAnd every morning, the mirror would reply, \"You, my Queen, are the fairest one of all.\" And the Queen would smile.\n\nBut Snow White grew more beautiful with each passing year. One fateful morning, the Queen asked her mirror the usual question. This time, the mirror said, \"You, my Queen, are fair, it is true. But Snow White is a thousand times more beautiful than you.\"\n\nThe Queen turned red with rage! She called for a huntsman and ordered him to take Snow White deep into the forest and never bring her back. But the huntsman was a kind man. He led Snow White into the woods and said, \"Run, princess. Run and never return to the castle.\"\n\nSnow White ran and ran until she was lost and alone. Just when she thought she could go no further, she stumbled upon a tiny cottage tucked between the trees. She knocked, but no one answered. The door was unlocked, so she went inside.\n\nEverything was small and neat. A little table with seven little chairs. Seven little plates. Seven little beds upstairs. Snow White was so tired that she lay across three of the little beds and fell fast asleep.\n\nThat evening, seven dwarfs came home from their work in the diamond mines. \"Someone's been in our house!\" they cried. They found Snow White sleeping peacefully. When she woke and told them her story, their hearts melted. \"Stay with us!\" they said. \"We'll keep you safe.\"\n\nSo Snow White stayed. She cooked and cleaned and sang, and the dwarfs loved her dearly. Doc, Grumpy, Happy, Sleepy, Bashful, Sneezy, and Dopey each watched out for her in their own way. Every morning when they left for work, they warned her, \"Don't open the door to strangers!\"\n\nBut the magic mirror told the Queen where Snow White was hiding. The wicked Queen disguised herself as an old peddler woman and traveled to the cottage. She carried a basket of apples. One apple was special. It was the most beautiful, shiny red apple you ever saw, but one bite would put anyone into a sleep as deep as death.\n\n\"Apples for sale! Beautiful apples!\" called the old woman.\n\nSnow White remembered the dwarfs' warning, but the apple looked so delicious. The old woman took a bite from the green side, which was safe, to prove it wasn't poisoned. Snow White took the beautiful red side and bit into it.\n\nShe fell to the ground instantly, the apple tumbling from her hand.\n\nWhen the dwarfs came home and found her, they wept bitterly. They could not wake her, no matter what they tried. She was so beautiful, even in sleep, that they could not bear to bury her. They made a glass case and placed her inside, keeping watch over her day and night.\n\nSeasons passed. One spring day, a prince was riding through the forest. He saw the glass case and the beautiful girl inside. He dismounted and gently kissed her forehead.\n\nSnow White's eyes fluttered open. She took a deep breath and smiled. The spell was broken! True love's kiss had awakened her.\n\nThe seven dwarfs danced with joy. Snow White and the prince were married in a grand celebration, and they invited everyone in the kingdom, even the smallest creatures of the forest.\n\nAnd they all lived happily ever after.\n\nThe End."},
{id:'s10',t:'Cinderella',a:'Charles Perrault',c:'fairytale',age:'4-8',mS:3,mL:8,
txS:"Once upon a time, kind Cinderella lived with her cruel stepmother and stepsisters. They made her cook and clean all day.\n\nWhen the King held a grand ball, a Fairy Godmother appeared! She turned a pumpkin into a carriage, gave Cinderella a beautiful gown and glass slippers. \"Be home by midnight!\"\n\nAt the ball, the prince fell in love with Cinderella. At midnight she ran, leaving one glass slipper. The prince searched everywhere. When the slipper fit Cinderella perfectly, they married and lived happily ever after. The End.",
txL:"Once upon a time, in a grand house by the market square, there lived a kind and gentle girl named Cinderella. After her dear father passed away, she was left with her stepmother and two stepsisters, who were terribly cruel.\n\nThey took her beautiful bedroom and gave her a tiny room in the attic. They took her pretty dresses and gave her rags. They made her cook the meals, scrub the floors, wash the clothes, and tend the fire until her face was smudged with cinders. That's how she got her name, Cinderella.\n\nDespite everything, Cinderella remained kind. She sang to the birds, befriended the mice, and never said a harsh word about anyone.\n\nOne exciting day, an invitation arrived from the palace. The King was holding a grand ball for his son, the prince! Every maiden in the kingdom was invited.\n\nThe stepsisters shrieked with delight. They ordered Cinderella to sew their dresses, curl their hair, and polish their shoes. \"Can I come too?\" asked Cinderella hopefully.\n\n\"YOU?\" they laughed. \"A dirty cinder girl at the royal ball? Don't be ridiculous!\"\n\nAfter they left in their fine carriage, Cinderella sat by the cold fireplace and cried. \"I wish I could go to the ball,\" she whispered.\n\nSuddenly, the room filled with sparkling light! A warm, kind voice said, \"Dry your tears, dear child.\" There stood her Fairy Godmother, surrounded by tiny floating stars.\n\n\"Bring me a pumpkin from the garden,\" she said. With a wave of her wand, the pumpkin swelled and transformed into a magnificent golden carriage! Six mice became six prancing white horses. A rat became a jolly coachman.\n\nThen the Fairy Godmother touched Cinderella's rags. They shimmered and transformed into the most beautiful ball gown anyone had ever seen, silver and blue, covered in tiny diamonds that sparkled like stars. On her feet appeared delicate glass slippers that caught the light like crystal.\n\n\"Now go, my dear, and enjoy yourself!\" said the Fairy Godmother. \"But remember this: the magic ends at the stroke of midnight. You MUST leave before then!\"\n\nCinderella arrived at the palace and everyone gasped. \"Who is that beautiful girl?\" whispered the guests. The prince saw her across the room, and his heart skipped a beat. He crossed the ballroom and bowed.\n\n\"May I have this dance?\"\n\nThey danced every dance together. They talked and laughed, and the prince was enchanted by her kindness and grace. Even the stepsisters didn't recognize her!\n\nCinderella was so happy that she almost forgot. Then she heard it. BONG! BONG! The great clock was striking midnight!\n\n\"I must go!\" she cried, pulling away from the prince. She ran down the grand staircase as fast as she could. In her hurry, one glass slipper slipped off her foot and clattered on the marble steps. She didn't dare stop to get it.\n\nBONG! The twelfth stroke sounded just as she reached the garden. Her gown turned back to rags. The carriage became a pumpkin. The horses became mice. But in her hand she still held one glass slipper.\n\nThe prince picked up the slipper on the stairs. \"I will find her,\" he declared. \"I will marry the girl whose foot fits this slipper.\"\n\nHe traveled to every house in the kingdom. Every girl tried the slipper, but it was always too big, too small, too wide, or too narrow. Finally, he came to Cinderella's house.\n\nThe stepsisters squeezed and pushed, but the slipper wouldn't fit. \"Is there anyone else?\" asked the prince. \"Just the cinder girl,\" they sneered.\n\nCinderella stepped forward. She slipped her foot into the glass slipper, and it fit perfectly. Then she pulled the matching slipper from her apron pocket.\n\nThe stepsisters' jaws dropped. The prince took Cinderella's hand. \"It's you,\" he said softly. \"I've found you.\"\n\nCinderella, with her kind heart, forgave her stepsisters. She and the prince were married in the grandest wedding the kingdom had ever seen, with music, flowers, and fireworks that painted the sky.\n\nAnd they lived happily ever after.\n\nThe End."},
{id:'s11',t:'Sleeping Beauty',a:'Charles Perrault',c:'fairytale',age:'4-8',mS:2,mL:7,
txS:"Once upon a time, fairies gave a baby princess gifts of beauty and kindness. But an uninvited fairy cursed her: she would prick her finger on a spindle and fall asleep forever.\n\nA good fairy softened the curse: true love's kiss could wake her. On her sixteenth birthday, the princess found a spinning wheel and fell into a deep sleep. The whole castle slept too.\n\nA hundred years later, a brave prince found her and kissed her. She woke up, the castle came alive, and they lived happily ever after. The End.",
txL:"Once upon a time, a king and queen had wished for a child for many years. When at last a beautiful baby girl was born, the whole kingdom celebrated. The king invited twelve fairies to a grand christening feast.\n\nOne by one, the fairies approached the cradle and gave the princess magical gifts. \"She shall have beauty,\" said the first. \"Grace,\" said the second. \"Kindness,\" said the third. \"Wisdom, a lovely singing voice, a gentle heart...\"\n\nBut before the twelfth fairy could give her gift, the castle doors burst open with a CRASH! In swept the thirteenth fairy, who had not been invited. Her eyes blazed with fury.\n\n\"You forgot ME!\" she shrieked. \"So here is MY gift! Before the sun sets on her sixteenth birthday, the princess shall prick her finger on the spindle of a spinning wheel and FALL INTO AN ENDLESS SLEEP!\"\n\nWith a flash of dark light, she vanished. The queen held her baby close, trembling. But the twelfth fairy had not yet given her gift. She could not undo the curse entirely, but she could soften it.\n\n\"The princess shall not die,\" she said gently. \"Instead, she shall fall into a deep sleep, and she shall be awakened by true love's kiss.\"\n\nThe king ordered every spinning wheel in the kingdom burned. For sixteen years, the princess grew up happy, beautiful, and kind, never knowing about the terrible curse.\n\nOn the morning of her sixteenth birthday, while everyone was preparing for the celebration, the curious princess explored a part of the castle she had never seen before. Up a winding staircase, behind a dusty door, she found a tiny room. Inside sat an old woman at a spinning wheel, the only one left in the kingdom.\n\n\"What a fascinating thing!\" said the princess. \"May I try?\" She reached out and touched the spindle.\n\nA single drop of blood appeared on her finger. The princess felt suddenly drowsy. Her eyes grew heavy, and she sank to the floor in a deep, enchanted sleep.\n\nThe spell spread through the castle like a wave. The king fell asleep on his throne. The queen dozed off in the garden. The cook slept at the stove. The dogs curled up in the courtyard. Even the flies on the wall stopped buzzing. The wind died, and not a leaf stirred.\n\nAround the silent castle, thick thorny roses grew, climbing higher and higher until the walls, towers, and gates were completely hidden. Years passed. Then decades. Then a century. The castle became a legend, a fairy tale that grandparents told their grandchildren.\n\n\"Behind those thorns,\" they said, \"sleeps a beautiful princess, waiting for true love's kiss.\"\n\nMany princes tried to cut through the thorns, but the vines were too strong. Then, exactly one hundred years after the princess fell asleep, a young prince came riding by. He was brave and kind, and when he heard the old story, he knew he had to try.\n\nAs he approached, something wonderful happened. The thorns parted before him, turning into beautiful blooming roses. Pink, red, and white flowers opened a path straight to the castle gate.\n\nInside, everything was still and silent. He walked through halls of sleeping servants, past sleeping guards and sleeping cats. Up the winding staircase he climbed, until he found the tiny room where the princess lay.\n\nShe was the most beautiful sight he had ever seen. He knelt beside her and gently kissed her.\n\nThe princess's eyes fluttered open. She looked at the prince and smiled, as if she had been waiting for him all along. \"You came,\" she whispered.\n\nAll around the castle, everyone woke up! The king stretched on his throne. The queen blinked in the garden. The cook finished stirring the pot. The dogs barked, the birds sang, and the wind blew once more.\n\nThe prince and the princess were married that very evening, and the celebration lasted seven days and seven nights.\n\nAnd they all lived happily ever after.\n\nThe End."},
{id:'s12',t:'Hansel and Gretel',a:'Brothers Grimm',c:'fairytale',age:'5-8',mS:3,mL:8,
txS:"Once upon a time, Hansel and Gretel were lost deep in the forest. After three days of wandering, they found an amazing house made of gingerbread and candy.\n\nAn old woman invited them in, but she was a wicked witch! She locked Hansel in a cage to fatten him up. Clever Hansel held out a thin bone so the witch thought he was still skinny.\n\nBrave Gretel tricked the witch into the oven and slammed the door shut! She freed Hansel, they found treasure, and walked home to their overjoyed father. They lived happily ever after. The End.",
txL:"Once upon a time, at the edge of a vast, dark forest, there lived a poor woodcutter with his two children, Hansel and Gretel. Times were very hard, and there was barely enough food to eat.\n\nOne dreadful day, the children's stepmother said, \"We cannot feed them anymore. We must leave them in the forest.\" The woodcutter wept, but he was too weak to argue.\n\nBut clever Hansel had been listening at the door. That night, he crept outside and filled his pockets with white pebbles that gleamed like silver coins in the moonlight.\n\nThe next morning, the family walked deep into the forest. As they walked, Hansel secretly dropped pebbles along the path. When the parents left them by a fire and disappeared, Hansel said, \"Don't worry, Gretel. Follow the pebbles!\" And sure enough, the shining pebbles led them safely home.\n\nBut the stepmother was furious. She locked the door that night so Hansel couldn't collect more pebbles. The next morning, all Hansel could grab was a crust of bread. As they walked into the forest, he dropped breadcrumbs along the path.\n\nThis time, when they tried to find their way home, the crumbs were gone! The birds had eaten every last one. The children were truly lost.\n\nThey wandered for three long days and nights, eating only berries and roots. They were cold, hungry, and frightened. Then, just when they had nearly given up hope, they saw something incredible through the trees.\n\nA house! But not just any house. The walls were made of gingerbread. The roof was made of cake. The windows were made of clear sugar candy. Gumdrops decorated the door, and licorice vines climbed the walls.\n\n\"I can't believe it!\" cried Gretel. They ran to the house and began to eat. Hansel broke off a piece of the roof. Gretel licked a windowpane.\n\nSuddenly, the door creaked open. Out came a very old woman leaning on a cane. She had kind eyes and a sweet voice. \"Oh, you poor dears! You must be so hungry. Come inside! I have warm beds and pancakes and hot chocolate!\"\n\nThe children went in gratefully. But the old woman's kindness was a trick. She was a wicked witch who had built the candy house to lure children! Her eyes were red and could barely see, but her nose could smell a child from miles away.\n\nThe next morning, she grabbed Hansel and locked him in an iron cage! \"I'm going to fatten you up and eat you!\" she cackled.\n\nEvery day, the witch made Gretel cook huge meals for Hansel. Porridge with cream, dumplings, pies, and puddings. Every day, the witch went to the cage and said, \"Hold out your finger, boy, so I can feel how fat you're getting!\"\n\nBut clever Hansel had found a thin chicken bone in his cage. Each time, he held out the bone instead of his finger. The witch, nearly blind, would squeeze the bone and grumble, \"Still too skinny! More food!\"\n\nThis went on for weeks. Finally, the witch lost all patience. \"Fat or thin, I'm going to eat him tomorrow!\" she told Gretel. \"Heat the oven!\"\n\nThe witch's big stone oven was roaring with flames. She told Gretel to lean inside and check if it was hot enough. But brave, clever Gretel knew what the witch was planning.\n\n\"I don't know how,\" said Gretel innocently. \"I've never checked an oven before. Could you show me?\"\n\nThe witch huffed impatiently. \"Silly girl! It's easy! Like this!\" She leaned into the oven.\n\nWith all her strength, Gretel pushed the witch inside and SLAMMED the iron door shut! That was the end of the wicked witch.\n\nGretel found the key and freed Hansel. They hugged each other tightly. Then they explored the witch's house and found chests overflowing with pearls, rubies, and gold coins. They filled their pockets until they could carry no more.\n\nThey walked and walked until they found a path, and the path led them home. Their father ran out crying tears of joy. The stepmother was gone. He had missed his children every single day.\n\nWith the witch's treasure, they never went hungry again. And Hansel and Gretel stayed close together, brave and clever, for the rest of their happy lives.\n\nThe End."},
];


// UI Components
function BG({dim}){
  const stars=useMemo(()=>[...Array(30)].map(()=>({l:`${Math.random()*100}%`,t:`${Math.random()*55}%`,s:Math.random()*2+.5,d:Math.random()*3+2,dl:Math.random()*4})),[]);
  const flies=useMemo(()=>[...Array(6)].map(()=>({l:`${Math.random()*100}%`,t:`${10+Math.random()*50}%`,d:Math.random()*4+3,dl:Math.random()*5})),[]);
  return(<div className={`bg ${dim?'dim':''}`}>{stars.map((s,i)=><div key={i} className="star" style={{left:s.l,top:s.t,width:s.s,height:s.s,animationDuration:`${s.d}s`,animationDelay:`${s.dl}s`}}/>)}<div className="moon"/>{flies.map((f,i)=><div key={`f${i}`} className="ff" style={{left:f.l,top:f.t,animationDuration:`${f.d}s`,animationDelay:`${f.dl}s`}}/>)}<div className="hills"><div className="hl"/><div className="hl"/><div className="hl"/></div></div>);
}
function Toast({msg}){return msg?<div className="toast">{msg}</div>:null}

// SVG Logos
function LogoFull({className=''}){
  return(<svg className={className} viewBox="0 0 320 200" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="mG" cx="50%" cy="50%" r="50%"><stop offset="0%" stopColor="#FFF8DC" stopOpacity=".25"/><stop offset="100%" stopColor="#FFF8DC" stopOpacity="0"/></radialGradient>
      <linearGradient id="a1" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor="#8B6FC0" stopOpacity="0"/><stop offset="30%" stopColor="#8B6FC0" stopOpacity=".15"/><stop offset="70%" stopColor="#55E6C1" stopOpacity=".1"/><stop offset="100%" stopColor="#55E6C1" stopOpacity="0"/></linearGradient>
      <linearGradient id="a2" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor="#55E6C1" stopOpacity="0"/><stop offset="40%" stopColor="#C5B3E6" stopOpacity=".12"/><stop offset="100%" stopColor="#FFD4A2" stopOpacity="0"/></linearGradient>
      <linearGradient id="bC" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#2A1F5E"/><stop offset="100%" stopColor="#1A1345"/></linearGradient>
      <linearGradient id="tG" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor="#E87B35"/><stop offset="100%" stopColor="#F5A623"/></linearGradient>
      <filter id="sG"><feGaussianBlur stdDeviation="1.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>
    <path d="M20 35 Q80 15 160 30 Q240 45 300 20" stroke="url(#a1)" strokeWidth="12" fill="none" opacity=".6"/>
    <path d="M0 50 Q100 25 200 45 Q280 58 320 35" stroke="url(#a2)" strokeWidth="8" fill="none" opacity=".5"/>
    <circle cx="160" cy="36" r="50" fill="url(#mG)"/>
    <circle cx="160" cy="30" r="22" fill="#FFF8DC"/><circle cx="160" cy="30" r="21" fill="#FFFEF5"/><circle cx="170" cy="24" r="17" fill="#070A1F"/>
    <circle cx="152" cy="28" r="2.5" fill="#F0E6B0" opacity=".4"/><circle cx="158" cy="36" r="1.8" fill="#F0E6B0" opacity=".3"/>
    <g filter="url(#sG)">
      <circle cx="52" cy="18" r="2" fill="#FFEAA7"/><circle cx="268" cy="12" r="2.5" fill="#FFEAA7"/>
      <circle cx="88" cy="8" r="1.5" fill="#FFF"/><circle cx="232" cy="5" r="1.8" fill="#FFF"/>
      <circle cx="40" cy="42" r="1.2" fill="#FFEAA7"/><circle cx="280" cy="38" r="1.5" fill="#FFEAA7"/>
      <circle cx="120" cy="12" r="1" fill="#FFF" opacity=".8"/><circle cx="200" cy="8" r="1.3" fill="#FFF" opacity=".7"/>
    </g>
    <path d="M70 28 L71.5 24 L73 28 L77 29.5 L73 31 L71.5 35 L70 31 L66 29.5Z" fill="#FFF" opacity=".7"/>
    <path d="M245 30 L246 27 L247 30 L250 31 L247 32 L246 35 L245 32 L242 31Z" fill="#FFF" opacity=".5"/>
    <path d="M95 85 Q160 95 160 78 Q160 95 225 85 L225 102 Q160 112 160 96 Q160 112 95 102Z" fill="url(#bC)" stroke="#3D2E7E" strokeWidth=".8"/>
    <line x1="108" y1="88" x2="150" y2="84" stroke="#C5B3E6" strokeWidth=".3" opacity=".2"/>
    <line x1="170" y1="84" x2="212" y2="88" stroke="#C5B3E6" strokeWidth=".3" opacity=".2"/>
    <line x1="160" y1="78" x2="160" y2="96" stroke="#C5B3E6" strokeWidth=".5" opacity=".3"/>
    <ellipse cx="155" cy="78" rx="22" ry="11" fill="#E87B35"/><ellipse cx="155" cy="78" rx="18" ry="8.5" fill="#F09548"/>
    <ellipse cx="155" cy="80" rx="12" ry="5" fill="#FFD4A2" opacity=".3"/>
    <path d="M177 74 Q195 58 215 60 Q235 62 245 78 Q248 84 240 86 Q232 88 226 80 Q220 72 206 70 Q192 68 182 76" fill="url(#tG)"/>
    <path d="M238 78 Q245 82 240 86 Q232 88 226 80" fill="#FFF8DC" opacity=".45"/>
    <circle cx="136" cy="72" r="11.5" fill="#E87B35"/><circle cx="136" cy="72" r="9.5" fill="#F09548"/>
    <polygon points="126,64 128,50 134,62" fill="#E87B35"/><polygon points="128,62 129,54 132,61" fill="#FFB8B8" opacity=".5"/>
    <polygon points="141,60 147,48 148,62" fill="#E87B35"/><polygon points="142.5,60 146,52 147,61" fill="#FFB8B8" opacity=".5"/>
    <path d="M130 72 Q133 69.5 136 72" stroke="#6B3410" strokeWidth="1.2" strokeLinecap="round" fill="none"/>
    <path d="M137.5 71.5 Q140.5 69 143.5 71.5" stroke="#6B3410" strokeWidth="1.2" strokeLinecap="round" fill="none"/>
    <ellipse cx="136" cy="75.5" rx="2.2" ry="1.4" fill="#2D1B0E"/>
    <ellipse cx="131.5" cy="76" rx="3.5" ry="2.5" fill="#FFF8DC" opacity=".35"/>
    <ellipse cx="140.5" cy="76" rx="3.5" ry="2.5" fill="#FFF8DC" opacity=".35"/>
    <path d="M134 76 Q136 78 138 76" stroke="#6B3410" strokeWidth=".7" strokeLinecap="round" fill="none"/>
    <text x="152" y="58" fill="#C5B3E6" fontSize="8" fontFamily="Baloo 2,cursive" fontWeight="700" opacity=".65">z</text>
    <text x="160" y="48" fill="#C5B3E6" fontSize="10" fontFamily="Baloo 2,cursive" fontWeight="700" opacity=".45">z</text>
    <text x="170" y="38" fill="#C5B3E6" fontSize="12" fontFamily="Baloo 2,cursive" fontWeight="700" opacity=".25">z</text>
    <text x="160" y="140" textAnchor="middle" fontFamily="Baloo 2,cursive" fontWeight="800" fontSize="40" letterSpacing="2">
      <tspan fill="#FFF8DC">T</tspan><tspan fill="#F5A623">a</tspan><tspan fill="#FFF8DC">il </tspan>
      <tspan fill="#C5B3E6" fontSize="28" dy="2">a</tspan><tspan dy="-2"> </tspan>
      <tspan fill="#FFF8DC">T</tspan><tspan fill="#F5A623">a</tspan><tspan fill="#FFF8DC">le</tspan>
    </text>
    <path d="M70 146 Q110 155 160 150 Q210 145 250 150" stroke="url(#tG)" strokeWidth="2.5" strokeLinecap="round" fill="none" opacity=".5"/>
    <text x="160" y="170" textAnchor="middle" fontFamily="Nunito,sans-serif" fontWeight="600" fontSize="12" fill="#A8A0C0" letterSpacing="3">BEDTIME STORIES IN YOUR VOICE</text>
  </svg>);
}
function LogoHeader(){
  return(<svg className="logo-hdr" viewBox="0 0 200 44" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="htG" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor="#E87B35"/><stop offset="100%" stopColor="#F5A623"/></linearGradient></defs>
    <circle cx="18" cy="16" r="9" fill="#FFF8DC"/><circle cx="22" cy="13" r="7" fill="#0B0E2D"/>
    <circle cx="6" cy="8" r="1" fill="#FFEAA7" opacity=".7"/><circle cx="32" cy="6" r=".8" fill="#FFEAA7" opacity=".5"/>
    <circle cx="20" cy="30" r="8" fill="#E87B35"/><circle cx="20" cy="30" r="6.5" fill="#F09548"/>
    <polygon points="13,25 14.5,17 18,24" fill="#E87B35"/><polygon points="14.5,24 15.5,19 17,23.5" fill="#FFB8B8" opacity=".5"/>
    <polygon points="24,23 28,16 28.5,24" fill="#E87B35"/><polygon points="25,23 27,18 27.5,23.5" fill="#FFB8B8" opacity=".5"/>
    <path d="M16 30 Q18 28 20 30" stroke="#6B3410" strokeWidth="1" strokeLinecap="round" fill="none"/>
    <path d="M21.5 29.5 Q23.5 27.5 25.5 29.5" stroke="#6B3410" strokeWidth="1" strokeLinecap="round" fill="none"/>
    <ellipse cx="20" cy="32.5" rx="1.5" ry="1" fill="#2D1B0E"/>
    <ellipse cx="17" cy="33" rx="2.2" ry="1.6" fill="#FFF8DC" opacity=".3"/><ellipse cx="23" cy="33" rx="2.2" ry="1.6" fill="#FFF8DC" opacity=".3"/>
    <path d="M28 30 Q36 22 44 26" stroke="url(#htG)" strokeWidth="2" strokeLinecap="round" fill="none" opacity=".5"/>
    <text x="48" y="32" fontFamily="Baloo 2,cursive" fontWeight="800" fontSize="24" letterSpacing=".5">
      <tspan fill="#FFF8DC">T</tspan><tspan fill="#F5A623">a</tspan><tspan fill="#FFF8DC">il </tspan>
      <tspan fill="#C5B3E6" fontSize="18" dy="1">a</tspan><tspan dy="-1"> </tspan>
      <tspan fill="#FFF8DC">T</tspan><tspan fill="#F5A623">a</tspan><tspan fill="#FFF8DC">le</tspan>
    </text>
  </svg>);
}

// Tutorial Stepper
function TutStepper({step}){
  const labels=['Account','Voice','Story','Play'];
  return(<div className="tut-steps">{labels.map((l,i)=><React.Fragment key={i}>
    {i>0&&<div className={`tut-line ${i<=step?'done':''}`}/>}
    <div className={`tut-dot ${i===step?'active':i<step?'done':''}`}>{i<step?<Icon name="check" size={14} color="var(--teal)"/>:i+1}</div>
  </React.Fragment>)}</div>);
}

// Tutorial Step 1: Welcome
function TutWelcome({onDone,lang,setLang,t}){
  const[name,setName]=useState('');
  const go=e=>{e.preventDefault();if(name.trim())onDone(name.trim())};
  return(<div className="wel fi"><LogoFull className="logo-welcome"/>
    <div className="wbx">
    <div style={{marginBottom:16}}><label className="il" style={{marginBottom:6,display:'block'}}><Icon name="globe" size={14}/> {t('language')}</label>
      <div className="langsel">{LANGS.map(l=><button key={l.c} className={`langopt ${lang===l.c?'a':''}`} onClick={()=>setLang(l.c)}>{l.f} {l.n}</button>)}</div></div>
    <form onSubmit={go}><div className="ig"><label className="il">{t('whosReading')}</label>
    <input className="inp" placeholder={t('placeholder')} value={name} onChange={e=>setName(e.target.value)} autoFocus/></div>
    <button className="btn bp bw" type="submit" disabled={!name.trim()}><Icon name="sparkle" size={18} color="#fff"/> {t('getStarted')}</button></form></div></div>);
}

// Tutorial Step 2: Voice
function TutVoice({voices,onSave,onSelect,selected,onNext,pw,t}){
  return(<div className="fi"><TutStepper step={1}/>
    <div className="tut-title">{t('setupVoice')}</div>
    <div className="tut-sub">{t('voiceSub')}</div>
    <Recorder onSave={onSave} t={t}/>
    {pw?.active&&<div className="prewarm"><span className="spinner"/> {t('warming')}</div>}
    {pw?.done&&<div className="prewarm" style={{color:'var(--teal)',borderColor:'rgba(85,230,193,.2)'}}><Icon name="check" size={14} color="var(--teal)"/> {t('cloneReady')}</div>}
    {voices.length>0&&<><div className="sh" style={{fontSize:16,marginTop:12}}><Icon name="brain" size={18} color="var(--teal)"/> {t('clonedVoices')}</div>
      {voices.map(v=><div key={v.id} className={`vc ${selected?.id===v.id?'sel':''}`} onClick={()=>onSelect(v)}>
        <div className="va va-u"><Icon name="mic" size={20} color="var(--teal)"/></div>
        <div><div className="vn">{v.name}</div><div className="vd">{t('aiClone')}</div></div>
        {selected?.id===v.id&&<span style={{marginLeft:'auto'}}><Icon name="check" size={18} color="var(--teal)"/></span>}
      </div>)}</>}
    <div className="sh" style={{fontSize:16,marginTop:12}}><Icon name="phone" size={18} color="var(--warm)"/> {t('deviceVoices')}</div>
    {[{id:'b1',name:'Sleepy Narrator'},{id:'b2',name:'Dreamy Storyteller'}].map(v=><div key={v.id} className={`vc ${selected?.id===v.id?'sel':''}`} onClick={()=>onSelect(v)}>
      <div className="va va-f"><Icon name="moon" size={20} color="var(--warm)"/></div>
      <div><div className="vn">{v.name}</div><div className="vd">{t('deviceVoice')}</div></div>
      {selected?.id===v.id&&<span style={{marginLeft:'auto'}}><Icon name="check" size={18} color="var(--teal)"/></span>}
    </div>)}
    <button className="btn bp bw" style={{marginTop:16}} onClick={onNext} disabled={!selected}>{t('continue')} <Icon name="right" size={18} color="#fff"/></button>
  </div>);
}

// Tutorial Step 3: Story
function TutStory({onSelect,selected,onNext,getVer,setVer,t}){
  const[filter,setFilter]=useState('all');
  const filtered=filter==='all'?S:S.filter(s=>s.c===filter);
  return(<div className="fi"><TutStepper step={2}/>
    <div className="tut-title">{t('pickStory')}</div>
    <div className="tut-sub">{t('storySub')}</div>
    <div className="flt">{[{k:'all',l:t('all')},{k:'fairytale',l:t('fairytales')},{k:'fable',l:t('fables')},{k:'bedtime',l:t('bedtime')}].map(f=>
      <button key={f.k} className={`fc ${filter===f.k?'a':''}`} onClick={()=>setFilter(f.k)}>{f.l}</button>)}</div>
    <div className="slist">{filtered.map(s=><div key={s.id} className={`sr ${selected?.id===s.id?'sel':''}`} onClick={()=>onSelect(s)}>
      <div className="se"><StoryIcon id={s.id} size={42}/></div>
      <div className="si"><div className="sn">{s.t}</div><div className="sd">{s.a} Â· {s.age} Â· ~{getVer(s.id)==='long'?s.mL:s.mS} min</div>
      <div className="ver-btns" onClick={e=>e.stopPropagation()}>
        <button className={`vbtn ${getVer(s.id)==='short'?'va2':''}`} onClick={()=>setVer(s.id,'short')}>{t('short')} ~{s.mS}m</button>
        <button className={`vbtn ${getVer(s.id)==='long'?'va2':''}`} onClick={()=>setVer(s.id,'long')}>{t('long')} ~{s.mL}m</button>
      </div></div>
      {selected?.id===s.id&&<Icon name="check" size={20} color="var(--lav)"/>}
    </div>)}</div>
    <button className="btn bp bw" style={{marginTop:8}} onClick={onNext} disabled={!selected}><Icon name="play" size={16} color="#fff"/> {t('startReading')}</button>
  </div>);
}

// Recorder
function Recorder({onSave,t}){
  const[rec,setRec]=useState(false);const[blob,setBlob]=useState(null);const[url,setUrl]=useState(null);
  const[vname,setVname]=useState('');const[timer,setTimer]=useState(0);
  const mr=useRef(null);const chunks=useRef([]);const tr=useRef(null);
  const start=async()=>{try{const s=await navigator.mediaDevices.getUserMedia({audio:true});mr.current=new MediaRecorder(s);chunks.current=[];mr.current.ondataavailable=e=>chunks.current.push(e.data);
    mr.current.onstop=()=>{const b=new Blob(chunks.current,{type:'audio/webm'});setBlob(b);setUrl(URL.createObjectURL(b))};
    mr.current.start();setRec(true);setTimer(0);tr.current=setInterval(()=>setTimer(t=>t+1),1000)}catch(e){alert('Microphone access needed')}};
  const stop=()=>{if(mr.current&&rec){mr.current.stop();setRec(false);clearInterval(tr.current)}};
  const save=()=>{if(blob&&vname.trim()){onSave(vname.trim(),blob);setBlob(null);setUrl(null);setVname('');setTimer(0)}};
  const reset=()=>{setBlob(null);setUrl(null);setTimer(0)};
  const fmt=s=>`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
  return(<div className="card fi"><div className="ct"><Icon name="mic" size={18} color="var(--coral)"/> {t('recordVoice')}</div><div className="cs">{t('readSoftly')}</div><div style={{textAlign:'center',padding:'20px 0'}}>
    {!blob?<><button className={`rb ${rec?'rec':''}`} onClick={rec?stop:start}>{rec?<Icon name="stop" size={28} color="#fff"/>:<Icon name="record" size={28} color="#fff"/>}</button>
      <p style={{marginTop:12,fontSize:13,color:'var(--txs)',fontWeight:600}}>{rec?`${t('recording')} ${fmt(timer)}`:t('tapRecord')}</p>
      {rec&&<div className="wf">{[...Array(10)].map((_,i)=><div key={i} className="wb" style={{animationDelay:`${i*.08}s`}}/>)}</div>}
      {rec&&<p style={{fontSize:12,color:'var(--txd)',maxWidth:260,margin:'0 auto',lineHeight:1.5}}>{t('readSample')}</p>}
    </>:<><p style={{marginBottom:12}}><Icon name="sparkle" size={32} color="var(--wg)"/></p>
      <p style={{fontWeight:700,marginBottom:12,color:'var(--moon)',fontSize:15}}>{t('recorded')} ({fmt(timer)})</p>
      <audio src={url} controls style={{width:'100%',maxWidth:280,marginBottom:14,filter:'invert(.85) hue-rotate(180deg)',borderRadius:8}}/>
      <div className="ig" style={{textAlign:'left',maxWidth:280,margin:'0 auto'}}><label className="il">{t('nameVoice')}</label><input className="inp" placeholder={t('voicePlaceholder')} value={vname} onChange={e=>setVname(e.target.value)}/></div>
      <div style={{display:'flex',gap:8,justifyContent:'center',marginTop:12}}><button className="btn bg2 bsm" onClick={reset}><Icon name="replay" size={14}/> {t('redo')}</button><button className="btn bgr bsm" onClick={save} disabled={!vname.trim()}><Icon name="check" size={14} color="#0B0E2D"/> {t('save')}</button></div></>}
  </div></div>);
}

// Player with Voice Cloning
function Player({story,voice,ver,onBack,show,t,text}){
  const[status,setStatus]=useState('idle');const[genMsg,setGenMsg]=useState('');
  const[progress,setProgress]=useState(0);const[highlight,setHighlight]=useState(-1);
  const[paused,setPaused]=useState(false);const[elapsed,setElapsed]=useState(0);
  const audioRef=useRef(null);const chunksAudio=useRef([]);const chunkDurations=useRef([]);
  const stopped=useRef(false);const pausedRef=useRef(false);const currentIdx=useRef(0);
  const allChunks=useRef([]);const rafRef=useRef(null);const readingRef=useRef(null);
  const content=text||(ver==='long'?story?.txL:story?.txS)||'';const paragraphs=content.split('\n\n');
  const storyMin=(ver==='long'?story?.mL:story?.mS)||4;
  const charToPara=(pos)=>{let p=0;for(let i=0;i<paragraphs.length;i++){p+=paragraphs[i].length+2;if(pos<p)return i}return paragraphs.length-1};
  const updateProgress=useCallback(()=>{
    if(stopped.current||!audioRef.current)return;const audio=audioRef.current;const total=allChunks.current.length;if(!total)return;
    const idx=currentIdx.current;let ct=0;for(let i=0;i<idx;i++)ct+=(chunkDurations.current[i]||3);
    const cd=audio.duration||3;const cc=audio.currentTime||0;ct+=cc;
    let td=0;for(let i=0;i<total;i++)td+=(chunkDurations.current[i]||(i<idx?3:cd));
    setProgress(Math.min(99.5,(ct/td)*100));setElapsed(Math.round(ct));
    let cp=0;for(let i=0;i<idx;i++)cp+=(allChunks.current[i]?.length||0);
    cp+=Math.round((allChunks.current[idx]?.length||0)*(cd>0?cc/cd:0));setHighlight(charToPara(cp));
    rafRef.current=requestAnimationFrame(updateProgress);
  },[]);
  const stopRAF=()=>{if(rafRef.current){cancelAnimationFrame(rafRef.current);rafRef.current=null}};
  const playChunk=(idx)=>{
    if(stopped.current||idx>=allChunks.current.length){setStatus('done');setProgress(100);setHighlight(-1);stopRAF();return}
    currentIdx.current=idx;const url=chunksAudio.current[idx];if(!url){playChunk(idx+1);return}
    if(audioRef.current){audioRef.current.src=url;
      audioRef.current.onloadedmetadata=()=>{chunkDurations.current[idx]=audioRef.current.duration};
      audioRef.current.onended=()=>playChunk(idx+1);audioRef.current.onerror=()=>playChunk(idx+1);
      audioRef.current.play().then(()=>{stopRAF();rafRef.current=requestAnimationFrame(updateProgress)}).catch(()=>playChunk(idx+1))}
  };
  const generateAndPlay=useCallback(async()=>{
    stopped.current=false;pausedRef.current=false;setPaused(false);
    setStatus('generating');setProgress(0);setHighlight(-1);setElapsed(0);
    chunksAudio.current=[];chunkDurations.current=[];currentIdx.current=0;
    let vb=null;if(voice?.id?.startsWith('v-')){const d=await dbGet('voices',voice.id);vb=d?.blob;console.log('Voice blob:',vb?.size,vb?.type)}
    if(!vb){setStatus('playing');fallbackTTS();return}
    const chunks=chunkText(content,280);allChunks.current=chunks;let started=false;
    for(let i=0;i<chunks.length;i++){if(stopped.current)return;
      setGenMsg(t('cloningPart')+' '+(i+1)+'/'+chunks.length);
      try{const blob=await generateChunk(chunks[i],vb);chunksAudio.current[i]=URL.createObjectURL(blob);
        const tmp=new Audio(chunksAudio.current[i]);
        await new Promise(r=>{tmp.onloadedmetadata=()=>{chunkDurations.current[i]=tmp.duration;r()};tmp.onerror=r;setTimeout(r,3000)});
        if(!started&&!stopped.current){started=true;setStatus('playing');setGenMsg('');playChunk(0)}
      }catch(e){console.error('Gen error',i,':',e);if(i===0){show('AI busy - using device voice');setStatus('playing');fallbackTTS();return}chunksAudio.current[i]=null}}
    if(!started&&!stopped.current){show('AI unavailable - device voice');setStatus('playing');fallbackTTS()}
  },[content,voice,show]);
  const fallbackTTS=()=>{const synth=window.speechSynthesis;synth.cancel();
    const chunks=chunkText(content,250);allChunks.current=chunks;let st=Date.now();
    const next=(idx)=>{if(idx>=chunks.length||stopped.current){setStatus('done');setProgress(100);setHighlight(-1);return}
      let cp=0;for(let j=0;j<idx;j++)cp+=chunks[j].length;setHighlight(charToPara(cp));setProgress((idx/chunks.length)*100);
      setElapsed(Math.round((Date.now()-st)/1000));
      const u=new SpeechSynthesisUtterance(chunks[idx]);u.rate=0.88;u.pitch=1.0;
      const vs=synth.getVoices();const pk=vs.find(v=>/Google.*en/i.test(v.name))||vs.find(v=>v.lang.startsWith('en'))||vs[0];
      if(pk)u.voice=pk;u.onend=()=>next(idx+1);u.onerror=e=>{if(e.error!=='canceled')next(idx+1)};synth.speak(u)};next(0)};
  const togglePause=()=>{if(status!=='playing')return;
    if(pausedRef.current){pausedRef.current=false;setPaused(false);if(audioRef.current?.paused){audioRef.current.play();rafRef.current=requestAnimationFrame(updateProgress)}else window.speechSynthesis?.resume()}
    else{pausedRef.current=true;setPaused(true);stopRAF();if(audioRef.current&&!audioRef.current.paused)audioRef.current.pause();else window.speechSynthesis?.pause()}};
  const stopAll=()=>{stopped.current=true;stopRAF();if(audioRef.current){audioRef.current.pause();audioRef.current.src=''}window.speechSynthesis?.cancel();setStatus('idle');setProgress(0);setHighlight(-1);setPaused(false);setElapsed(0)};
  const handleSeek=(e)=>{if(status!=='playing'||!allChunks.current.length)return;
    const rect=e.currentTarget.getBoundingClientRect();const cx=e.touches?e.touches[0].clientX:e.clientX;
    const pct=Math.max(0,Math.min(1,(cx-rect.left)/rect.width));
    let td=0;for(let i=0;i<allChunks.current.length;i++)td+=(chunkDurations.current[i]||3);
    const tt=pct*td;let ac=0;let ti=0;let st=0;
    for(let i=0;i<allChunks.current.length;i++){const d=chunkDurations.current[i]||3;if(ac+d>tt){ti=i;st=tt-ac;break}ac+=d;ti=i;st=0}
    stopRAF();if(audioRef.current){audioRef.current.pause();audioRef.current.src=''}window.speechSynthesis?.cancel();
    if(chunksAudio.current[ti]){currentIdx.current=ti;audioRef.current.src=chunksAudio.current[ti];
      audioRef.current.onloadedmetadata=()=>{audioRef.current.currentTime=Math.min(st,audioRef.current.duration-0.1);audioRef.current.play().then(()=>{rafRef.current=requestAnimationFrame(updateProgress)})};
      audioRef.current.onended=()=>playChunk(ti+1);audioRef.current.onerror=()=>playChunk(ti+1);audioRef.current.load()}else playChunk(ti)};
  useEffect(()=>{if(highlight>=0&&readingRef.current){const ps=readingRef.current.querySelectorAll('p');if(ps[highlight])ps[highlight].scrollIntoView({behavior:'smooth',block:'center'})}},[highlight]);
  useEffect(()=>()=>{stopped.current=true;stopRAF();window.speechSynthesis?.cancel()},[]);
  const isClone=voice?.id?.startsWith('v-');const fmtSec=(s)=>Math.floor(s/60)+':'+String(s%60).padStart(2,'0');
  return(<div className="fi">
    <audio ref={audioRef} style={{display:'none'}}/>
    <button className="btn bg2 bsm" onClick={()=>{stopAll();onBack()}} style={{marginBottom:10}}><Icon name="back" size={16}/> {t('back')}</button>
    <div className="pc"><div className="pb">
      <div className="pti">{story?.t||t('story')}</div><div className="pau">{story?.a||''}</div>
      <div className="pbar" onClick={handleSeek} onTouchEnd={e=>{e.preventDefault();handleSeek(e)}}><div className="pbtr"><div className="pbfl" style={{width:progress+'%'}}><div className="pbth"/></div></div></div>
      <div className="ptm"><span>{fmtSec(elapsed)}</span><span>~{storyMin}:00</span></div>
      <div className="pcc">
        {status==='idle'&&<button className="cb pp" onClick={generateAndPlay}><Icon name="play" size={26} color="#fff"/></button>}
        {status==='generating'&&<span className="spinner" style={{width:24,height:24,border:'2px solid rgba(197,179,230,.3)',borderTopColor:'var(--lav)',borderRadius:'50%',animation:'spin 1s linear infinite',display:'inline-block'}}/>}
        {status==='playing'&&<><button className="cb" onClick={togglePause}><Icon name={paused?'play':'pause'} size={20} color="rgba(255,255,255,.6)"/></button><button className="cb pp" onClick={stopAll}><Icon name="stop" size={22} color="#fff"/></button></>}
        {status==='done'&&<button className="cb pp" onClick={generateAndPlay}><Icon name="replay" size={22} color="#fff"/></button>}
      </div>
      <div className="pvb">{t('voice')}: <b>{voice?.name||'Device Default'}</b>{isClone&&<> Â· <Icon name="brain" size={12} color="var(--wg)"/> AI Clone</>}</div>
    </div></div>
    {status==='generating'&&<div className="genst"><span className="spinner"/>{genMsg}<br/><span style={{fontSize:11,color:'var(--txd)'}}>{t('gpuWake')}</span></div>}
    {status==='done'&&<div className="genst"><span className="done"><Icon name="check" size={14} color="var(--teal)"/> {t('storyComplete')}</span></div>}
    <div className="ra" ref={readingRef}>{paragraphs.map((p,i)=><p key={i} className={i===highlight?'hl2':''}>{p}</p>)}</div>
  </div>);
}

// Main App
function App(){
  const[name,setName]=useState(()=>{
    if(localStorage.getItem('tat_v')!=='5'){localStorage.removeItem('sv_name');localStorage.removeItem('tat_name');localStorage.removeItem('tat_v');return ''}
    return localStorage.getItem('tat_name')||''});
  const[tutDone,setTutDone]=useState(()=>localStorage.getItem('tat_tut')==='1');
  const[tutStep,setTutStep]=useState(0);
  const[tab,setTab]=useState('stories');
  const[voices,setVoices]=useState([]);const[sv,setSv]=useState(null);const[ss,setSs]=useState(null);
  const[filter,setFilter]=useState('all');const[toast,setToast]=useState('');const[gOk,setGOk]=useState(false);
  const[verPrefs,setVerPrefs]=useState(()=>{try{return JSON.parse(localStorage.getItem('tat_verPrefs')||'{}')}catch{return {}}});
  const[pw,setPw]=useState({active:false,done:false,error:false});
  const[lang,setLangState]=useState(()=>localStorage.getItem('tat_lang')||'en');
  const[menu,setMenu]=useState(false);
  const[tlCache,setTlCache]=useState({});
  const[translating,setTranslating]=useState(false);

  const t=useMemo(()=>makeT(lang),[lang]);
  const dir=useMemo(()=>getLangDir(lang),[lang]);

  const setLang=(l)=>{setLangState(l);localStorage.setItem('tat_lang',l);document.documentElement.dir=getLangDir(l)};
  const setVer=(sid,ver)=>{const nv={...verPrefs,[sid]:ver};setVerPrefs(nv);localStorage.setItem('tat_verPrefs',JSON.stringify(nv))};
  const getVer=(sid)=>verPrefs[sid]||'short';

  useEffect(()=>{document.documentElement.dir=dir;
    try{const vl=JSON.parse(localStorage.getItem('sv_voices')||'[]');setVoices(vl);
    const lv=localStorage.getItem('tat_lastVoice');if(lv){const f=vl.find(v=>v.id===lv);if(f)setSv(f)}}catch{}
    speechSynthesis?.getVoices();if(speechSynthesis)speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices();
    initGradio().then(c=>{if(c)setGOk(true)});
    return onPreWarmChange(s=>setPw(s));},[]);

  // Translation helper
  const getTranslatedText=useCallback(async(storyId,ver)=>{
    if(lang==='en')return null;
    const key=`${storyId}_${ver}_${lang}`;
    if(tlCache[key])return tlCache[key];
    // Check DB
    const cached=await dbGet('translations',key);
    if(cached){setTlCache(p=>({...p,[key]:cached.text}));return cached.text}
    // Translate
    setTranslating(true);
    try{
      const story=S.find(s=>s.id===storyId);if(!story)return null;
      const src=ver==='long'?story.txL:story.txS;
      const result=await translateText(src,'en',lang);
      setTlCache(p=>({...p,[key]:result}));
      setTranslating(false);return result;
    }catch(e){setTranslating(false);return null}
  },[lang,tlCache]);

  // Pre-translate selected story when entering player
  const[playerText,setPlayerText]=useState(null);
  const playStory=async()=>{if(!ss){show(t('noneSelected'));return}
    if(lang!=='en'){setTab('player');setPlayerText(null);setTranslating(true);
      const txt=await getTranslatedText(ss.id,getVer(ss.id));
      setPlayerText(txt);setTranslating(false);
    }else{setPlayerText(null);setTab('player')}};

  const show=m=>{setToast(m);setTimeout(()=>setToast(''),2800)};
  const saveVoice=async(vn,blob)=>{const id='v-'+Date.now();await dbPut('voices',{id,blob,ts:Date.now()});
    const v={id,name:vn,ts:Date.now()};const nv=[v,...voices];setVoices(nv);
    localStorage.setItem('sv_voices',JSON.stringify(nv));setSv(v);localStorage.setItem('tat_lastVoice',id);show(t('save')+'! '+t('warming'));
    preWarmVoice(id)};
  const selectVoice=(v)=>{setSv(v);localStorage.setItem('tat_lastVoice',v.id)};
  const delVoice=async id=>{await dbDel('voices',id);const nv=voices.filter(v=>v.id!==id);setVoices(nv);localStorage.setItem('sv_voices',JSON.stringify(nv));if(sv?.id===id)setSv(null);show('Removed')};
  const filtered=filter==='all'?S:S.filter(s=>s.c===filter);
  const finishName=(n)=>{setName(n);localStorage.setItem('tat_name',n);localStorage.setItem('tat_v','5')};
  const finishTut=async()=>{setTutDone(true);localStorage.setItem('tat_tut','1');
    if(lang!=='en'&&ss){setTab('player');setPlayerText(null);setTranslating(true);
      const txt=await getTranslatedText(ss.id,getVer(ss.id));setPlayerText(txt);setTranslating(false);
    }else{setTab('player')}};
  const doLogout=()=>{localStorage.removeItem('tat_name');localStorage.removeItem('tat_v');localStorage.removeItem('tat_tut');setName('');setTutDone(false);setTutStep(0);setSv(null);setSs(null);speechSynthesis?.cancel();setMenu(false)};

  if(!name)return<><BG/><div className="app" dir={dir}><TutWelcome onDone={finishName} lang={lang} setLang={setLang} t={t}/></div></>;

  if(!tutDone)return(<><BG dim/><div className="app" dir={dir}>
    <div className="hdr"><div className="logo"><LogoHeader/></div><span style={{fontSize:12,color:'var(--txd)',fontWeight:600}}>{t('hi')}, {name}</span></div>
    <div className="main">
      {tutStep===0&&<TutVoice voices={voices} onSave={saveVoice} onSelect={selectVoice} selected={sv} onNext={()=>setTutStep(1)} pw={pw} t={t}/>}
      {tutStep===1&&<TutStory onSelect={setSs} selected={ss} onNext={()=>{setTutStep(2);finishTut()}} getVer={getVer} setVer={setVer} t={t}/>}
    </div><Toast msg={toast}/></div></>);

  return(<><BG dim/><div className="app" dir={dir}>
    <div className="hdr"><div className="logo"><LogoHeader/></div>
      <button className="hbtn" onClick={()=>setMenu(!menu)}><Icon name="user" size={14}/> {name}</button>
      {menu&&<><div style={{position:'fixed',inset:0,zIndex:40}} onClick={()=>setMenu(false)}/>
        <div className="ddmenu">
          <div style={{padding:'6px 14px 2px',fontSize:11,color:'var(--txd)',fontWeight:700,textTransform:'uppercase',letterSpacing:1}}>{t('settings')}</div>
          <div className="ddi" style={{cursor:'default',flexDirection:'column',alignItems:'stretch',gap:6}}>
            <div style={{display:'flex',alignItems:'center',gap:6}}><Icon name="globe" size={14}/> {t('language')}</div>
            <div className="langsel" style={{margin:0}}>{LANGS.map(l=><button key={l.c} className={`langopt ${lang===l.c?'a':''}`} onClick={()=>{setLang(l.c);setTlCache({})}}>{l.f} {l.n}</button>)}</div>
          </div>
          <div className="ddiv"/>
          <button className="ddi" onClick={doLogout}><Icon name="logout" size={16} color="var(--coral)"/> {t('switchUser')}</button>
        </div></>}
    </div>
    <div className="main">
      {tab==='stories'&&<div className="fi">
        <div className="sh"><Icon name="book" size={22} color="var(--moon)"/> {t('bedtimeStories')}</div>
        <div className="ss">{t('chooseAdventure')}</div>
        <div className="flt">{[{k:'all',l:t('all')},{k:'fairytale',l:t('fairytales')},{k:'fable',l:t('fables')},{k:'bedtime',l:t('bedtime')}].map(f=><button key={f.k} className={`fc ${filter===f.k?'a':''}`} onClick={()=>setFilter(f.k)}>{f.l}</button>)}</div>
        <div className="slist">{filtered.map(s=><div key={s.id} className={`sr ${ss?.id===s.id?'sel':''}`} onClick={()=>{setSs(s);show(s.t)}}>
          <div className="se"><StoryIcon id={s.id} size={42}/></div>
          <div className="si"><div className="sn">{s.t}</div><div className="sd">{s.a} Â· {s.age} Â· ~{getVer(s.id)==='long'?s.mL:s.mS} min</div>
          <div className="ver-btns" onClick={e=>e.stopPropagation()}>
            <button className={`vbtn ${getVer(s.id)==='short'?'va2':''}`} onClick={()=>setVer(s.id,'short')}>{t('short')} ~{s.mS}m</button>
            <button className={`vbtn ${getVer(s.id)==='long'?'va2':''}`} onClick={()=>setVer(s.id,'long')}>{t('long')} ~{s.mL}m</button>
          </div></div>
          {ss?.id===s.id&&<Icon name="check" size={20} color="var(--lav)"/>}
        </div>)}</div></div>}

      {tab==='voices'&&<div className="fi">
        <div className="sh"><Icon name="mic" size={22} color="var(--moon)"/> {t('yourVoices')}</div>
        <div className="ss">{t('recSub')}</div>
        <Recorder onSave={saveVoice} t={t}/>
        {pw.active&&<div className="prewarm"><span className="spinner"/> {t('warming')}</div>}
        {pw.done&&<div className="prewarm" style={{color:'var(--teal)',borderColor:'rgba(85,230,193,.2)'}}><Icon name="check" size={14} color="var(--teal)"/> {t('cloneReady')}</div>}
        <div className="slist">
        {voices.length>0&&<><div className="sh" style={{fontSize:16,marginTop:12}}><Icon name="brain" size={18} color="var(--teal)"/> {t('clonedVoices')}</div>
          {voices.map(v=><div key={v.id} className={`vc ${sv?.id===v.id?'sel':''}`} onClick={()=>selectVoice(v)}>
            <div className="va va-u"><Icon name="mic" size={20} color="var(--teal)"/></div><div><div className="vn">{v.name}</div><div className="vd">{t('aiClone')}</div></div>
            {sv?.id===v.id&&<span style={{marginLeft:'auto'}}><Icon name="check" size={18} color="var(--teal)"/></span>}
            <button className="vx" onClick={e=>{e.stopPropagation();delVoice(v.id)}}><Icon name="trash" size={14}/></button></div>)}</>}
        <div className="sh" style={{fontSize:16,marginTop:16}}><Icon name="phone" size={18} color="var(--warm)"/> {t('deviceVoices')}</div>
        {[{id:'b1',name:'Sleepy Narrator'},{id:'b2',name:'Dreamy Storyteller'}].map(v=><div key={v.id} className={`vc ${sv?.id===v.id?'sel':''}`} onClick={()=>selectVoice(v)}>
          <div className="va va-f"><Icon name="moon" size={20} color="var(--warm)"/></div><div><div className="vn">{v.name}</div><div className="vd">{t('deviceVoice')}</div></div>
          {sv?.id===v.id&&<span style={{marginLeft:'auto'}}><Icon name="check" size={18} color="var(--teal)"/></span>}</div>)}
        </div>
        <div className="info"><b>{t('howClone')}</b> {t('howCloneDesc')}</div></div>}

      {tab==='play'&&<div className="fi">
        <div className="sh"><Icon name="sparkle" size={22} color="var(--moon)"/> {t('goodnight')}</div>
        <div className="steps"><div className={`step ${sv?'d':'a'}`}/><div className={`step ${ss?'d':sv?'a':''}`}/><div className={`step ${sv&&ss?'a':''}`}/></div>
        <div className="card" style={{borderLeft:'3px solid '+(sv?'var(--teal)':'var(--wg)')}}>
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <div><div className="ct"><Icon name={sv?'check':'mic'} size={16} color={sv?'var(--teal)':'var(--txd)'}/> {t('voice')}</div><div className="cs">{sv?sv.name+(sv.id?.startsWith('v-')?' Â· AI Clone':' Â· Device'):t('noneSelected')}</div></div>
            <button className="btn bg2 bsm" onClick={()=>setTab('voices')}>{sv?t('change'):t('pick')}</button></div></div>
        <div className="card" style={{borderLeft:'3px solid '+(ss?'var(--teal)':'var(--wg)')}}>
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <div><div className="ct"><Icon name={ss?'check':'book'} size={16} color={ss?'var(--teal)':'var(--txd)'}/> {t('story')}</div><div className="cs">{ss?ss.t:t('noneSelected')}</div>
            {ss&&<div className="ver-btns" style={{marginTop:4}}>
              <button className={`vbtn ${getVer(ss.id)==='short'?'va2':''}`} onClick={()=>setVer(ss.id,'short')}>{t('short')} ~{ss.mS}m</button>
              <button className={`vbtn ${getVer(ss.id)==='long'?'va2':''}`} onClick={()=>setVer(ss.id,'long')}>{t('long')} ~{ss.mL}m</button>
            </div>}</div>
            <button className="btn bg2 bsm" onClick={()=>setTab('stories')}>{ss?t('change'):t('pick')}</button></div></div>
        <button className="btn bp bw" onClick={playStory} disabled={!ss} style={{marginTop:8,fontSize:18,padding:'16px 24px'}}><Icon name="play" size={18} color="#fff"/> {t('beginStory')}</button>
        {pw.active&&<div className="prewarm" style={{marginTop:10}}><span className="spinner"/> {t('warming')}</div>}
        {pw.done&&!pw.active&&<div className="prewarm" style={{marginTop:10,color:'var(--teal)',borderColor:'rgba(85,230,193,.2)'}}><Icon name="check" size={14} color="var(--teal)"/> {t('cloneReady')}</div>}
        <div className="info" style={{marginTop:12}}><b>{gOk?t('connected'):t('connecting')}</b><br/>
          {sv?.id?.startsWith('v-')?t('cloneMsg'):t('deviceMsg')}</div></div>}

      {tab==='player'&&ss&&<>{translating&&!playerText&&<div className="tl-spinner"><span className="spinner"/> Translating story...</div>}
        <Player story={ss} voice={sv} ver={getVer(ss.id)} text={playerText} onBack={()=>{setTab('play');setPlayerText(null)}} show={show} t={t}/></>}
    </div>
    {tab!=='player'&&<div className="nav">
      <button className={`ni ${tab==='stories'?'a':''}`} onClick={()=>setTab('stories')}><Icon name="book" size={22} color={tab==='stories'?'var(--moon)':'var(--txd)'}/><span className="ni-l">{t('stories')}</span></button>
      <button className={`ni ${tab==='voices'?'a':''}`} onClick={()=>setTab('voices')}><Icon name="mic" size={22} color={tab==='voices'?'var(--moon)':'var(--txd)'}/><span className="ni-l">{t('voices')}</span></button>
      <button className={`ni ${tab==='play'?'a':''}`} onClick={()=>setTab('play')}><Icon name="play" size={22} color={tab==='play'?'var(--moon)':'var(--txd)'}/><span className="ni-l">{t('play')}</span></button>
    </div>}
    <Toast msg={toast}/>
  </div></>);
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);

</script>
</body>
</html>
